<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>./Data/ByteString/Short/Internal.hs</title>
</head>
<head>
<link type='text/css' rel='stylesheet' href='liquid.css' />
</head>

<body>
<hr>
Put mouse over identifiers to see inferred types
<pre><span class=hs-linenum>   1: </span><span class='hs-comment'>{-# LANGUAGE BangPatterns             #-}</span>
<span class=hs-linenum>   2: </span><span class='hs-comment'>{-# LANGUAGE CPP                      #-}</span>
<span class=hs-linenum>   3: </span><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable       #-}</span>
<span class=hs-linenum>   4: </span><span class='hs-comment'>{-# LANGUAGE DeriveGeneric            #-}</span>
<span class=hs-linenum>   5: </span><span class='hs-comment'>{-# LANGUAGE DeriveLift               #-}</span>
<span class=hs-linenum>   6: </span><span class='hs-comment'>{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span>
<span class=hs-linenum>   7: </span><span class='hs-comment'>{-# LANGUAGE LambdaCase               #-}</span>
<span class=hs-linenum>   8: </span><span class='hs-comment'>{-# LANGUAGE MagicHash                #-}</span>
<span class=hs-linenum>   9: </span><span class='hs-comment'>{-# LANGUAGE MultiWayIf               #-}</span>
<span class=hs-linenum>  10: </span><span class='hs-comment'>{-# LANGUAGE PatternSynonyms          #-}</span>
<span class=hs-linenum>  11: </span><span class='hs-comment'>{-# LANGUAGE RankNTypes               #-}</span>
<span class=hs-linenum>  12: </span><span class='hs-comment'>{-# LANGUAGE ScopedTypeVariables      #-}</span>
<span class=hs-linenum>  13: </span><span class='hs-comment'>{-# LANGUAGE TemplateHaskellQuotes    #-}</span>
<span class=hs-linenum>  14: </span><span class='hs-comment'>{-# LANGUAGE TupleSections            #-}</span>
<span class=hs-linenum>  15: </span><span class='hs-comment'>{-# LANGUAGE TypeFamilies             #-}</span>
<span class=hs-linenum>  16: </span><span class='hs-comment'>{-# LANGUAGE UnboxedTuples            #-}</span>
<span class=hs-linenum>  17: </span><span class='hs-comment'>{-# LANGUAGE UnliftedFFITypes         #-}</span>
<span class=hs-linenum>  18: </span><span class='hs-comment'>{-# LANGUAGE Unsafe                   #-}</span>
<span class=hs-linenum>  19: </span><span class='hs-comment'>{-# LANGUAGE ViewPatterns             #-}</span>
<span class=hs-linenum>  20: </span>
<span class=hs-linenum>  21: </span><span class='hs-comment'>{-# OPTIONS_HADDOCK not-home #-}</span>
<span class=hs-linenum>  22: </span>
<span class=hs-linenum>  23: </span><span class='hs-comment'>{-# OPTIONS_GHC -fexpose-all-unfoldings #-}</span>
<span class=hs-linenum>  24: </span>
<span class=hs-linenum>  25: </span><span class='hs-keyword'>{-@</span> <span class='hs-conid'>LIQUID</span> <span class='hs-str'>"--compile-spec"</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>  26: </span>
<span class=hs-linenum>  27: </span><span class='hs-cpp'>#include "bytestring-cpp-macros.h"</span>
<span class=hs-linenum>  28: </span>
<span class=hs-linenum>  29: </span><span class='hs-comment'>-- |</span>
<span class=hs-linenum>  30: </span><span class='hs-comment'>-- Module      : Data.ByteString.Short.Internal</span>
<span class=hs-linenum>  31: </span><span class='hs-comment'>-- Copyright   : (c) Duncan Coutts 2012-2013, Julian Ospald 2022</span>
<span class=hs-linenum>  32: </span><span class='hs-comment'>-- License     : BSD-style</span>
<span class=hs-linenum>  33: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>  34: </span><span class='hs-comment'>-- Maintainer  : hasufell@posteo.de</span>
<span class=hs-linenum>  35: </span><span class='hs-comment'>-- Stability   : stable</span>
<span class=hs-linenum>  36: </span><span class='hs-comment'>-- Portability : ghc only</span>
<span class=hs-linenum>  37: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>  38: </span><span class='hs-comment'>-- Internal representation of ShortByteString</span>
<span class=hs-linenum>  39: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>  40: </span><span class='hs-keyword'>module</span> <span class='hs-conid'>Data.ByteString.Short.Internal</span> <span class='hs-layout'>(</span>
<span class=hs-linenum>  41: </span>
<span class=hs-linenum>  42: </span>    <span class='hs-comment'>-- * The @ShortByteString@ type and representation</span>
<span class=hs-linenum>  43: </span>    <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>,</span> <span class='hs-conid'>SBS</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  44: </span>
<span class=hs-linenum>  45: </span>    <span class='hs-comment'>-- * Introducing and eliminating 'ShortByteString's</span>
<span class=hs-linenum>  46: </span>    <span class='hs-varid'>empty</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  47: </span>    <span class='hs-varid'>singleton</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  48: </span>    <span class='hs-varid'>pack</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  49: </span>    <span class='hs-varid'>unpack</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  50: </span>    <span class='hs-varid'>fromShort</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  51: </span>    <span class='hs-varid'>toShort</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  52: </span>
<span class=hs-linenum>  53: </span>    <span class='hs-comment'>-- * Basic interface</span>
<span class=hs-linenum>  54: </span>    <span class='hs-varid'>snoc</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  55: </span>    <span class='hs-varid'>cons</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  56: </span>    <span class='hs-varid'>append</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  57: </span>    <span class='hs-varid'>last</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  58: </span>    <span class='hs-varid'>tail</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  59: </span>    <span class='hs-varid'>uncons</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  60: </span>    <span class='hs-varid'>head</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  61: </span>    <span class='hs-varid'>init</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  62: </span>    <span class='hs-varid'>unsnoc</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  63: </span>    <span class='hs-varid'>null</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  64: </span>    <span class='hs-varid'>length</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  65: </span>
<span class=hs-linenum>  66: </span>    <span class='hs-comment'>-- * Transforming ShortByteStrings</span>
<span class=hs-linenum>  67: </span>    <span class='hs-varid'>map</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  68: </span>    <span class='hs-varid'>reverse</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  69: </span>    <span class='hs-varid'>intercalate</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  70: </span>
<span class=hs-linenum>  71: </span>    <span class='hs-comment'>-- * Reducing 'ShortByteString's (folds)</span>
<span class=hs-linenum>  72: </span>    <span class='hs-varid'>foldl</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  73: </span>    <span class='hs-varid'>foldl'</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  74: </span>    <span class='hs-varid'>foldl1</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  75: </span>    <span class='hs-varid'>foldl1'</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  76: </span>
<span class=hs-linenum>  77: </span>    <span class='hs-varid'>foldr</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  78: </span>    <span class='hs-varid'>foldr'</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  79: </span>    <span class='hs-varid'>foldr1</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  80: </span>    <span class='hs-varid'>foldr1'</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  81: </span>
<span class=hs-linenum>  82: </span>    <span class='hs-comment'>-- ** Special folds</span>
<span class=hs-linenum>  83: </span>    <span class='hs-varid'>all</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  84: </span>    <span class='hs-varid'>any</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  85: </span>    <span class='hs-varid'>concat</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  86: </span>
<span class=hs-linenum>  87: </span>    <span class='hs-comment'>-- ** Generating and unfolding ShortByteStrings</span>
<span class=hs-linenum>  88: </span>    <span class='hs-varid'>replicate</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  89: </span>    <span class='hs-varid'>unfoldr</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  90: </span>    <span class='hs-varid'>unfoldrN</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  91: </span>
<span class=hs-linenum>  92: </span>    <span class='hs-comment'>-- * Substrings</span>
<span class=hs-linenum>  93: </span>
<span class=hs-linenum>  94: </span>    <span class='hs-comment'>-- ** Breaking strings</span>
<span class=hs-linenum>  95: </span>    <span class='hs-varid'>take</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  96: </span>    <span class='hs-varid'>takeEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  97: </span>    <span class='hs-varid'>takeWhileEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  98: </span>    <span class='hs-varid'>takeWhile</span><span class='hs-layout'>,</span>
<span class=hs-linenum>  99: </span>    <span class='hs-varid'>drop</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 100: </span>    <span class='hs-varid'>dropEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 101: </span>    <span class='hs-varid'>dropWhile</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 102: </span>    <span class='hs-varid'>dropWhileEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 103: </span>    <span class='hs-varid'>breakEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 104: </span>    <span class='hs-varid'>break</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 105: </span>    <span class='hs-varid'>span</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 106: </span>    <span class='hs-varid'>spanEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 107: </span>    <span class='hs-varid'>splitAt</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 108: </span>    <span class='hs-varid'>split</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 109: </span>    <span class='hs-varid'>splitWith</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 110: </span>    <span class='hs-varid'>stripSuffix</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 111: </span>    <span class='hs-varid'>stripPrefix</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 112: </span>
<span class=hs-linenum> 113: </span>    <span class='hs-comment'>-- * Predicates</span>
<span class=hs-linenum> 114: </span>    <span class='hs-varid'>isInfixOf</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 115: </span>    <span class='hs-varid'>isPrefixOf</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 116: </span>    <span class='hs-varid'>isSuffixOf</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 117: </span>
<span class=hs-linenum> 118: </span>    <span class='hs-comment'>-- ** Search for arbitrary substrings</span>
<span class=hs-linenum> 119: </span>    <span class='hs-varid'>breakSubstring</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 120: </span>
<span class=hs-linenum> 121: </span>    <span class='hs-comment'>-- * Searching ShortByteStrings</span>
<span class=hs-linenum> 122: </span>
<span class=hs-linenum> 123: </span>    <span class='hs-comment'>-- ** Searching by equality</span>
<span class=hs-linenum> 124: </span>    <span class='hs-varid'>elem</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 125: </span>
<span class=hs-linenum> 126: </span>    <span class='hs-comment'>-- ** Searching with a predicate</span>
<span class=hs-linenum> 127: </span>    <span class='hs-varid'>find</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 128: </span>    <span class='hs-varid'>filter</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 129: </span>    <span class='hs-varid'>partition</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 130: </span>
<span class=hs-linenum> 131: </span>    <span class='hs-comment'>-- * Indexing ShortByteStrings</span>
<span class=hs-linenum> 132: </span>    <span class='hs-varid'>index</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 133: </span>    <span class='hs-varid'>indexMaybe</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 134: </span>    <span class='hs-layout'>(</span><span class='hs-varop'>!?</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 135: </span>    <span class='hs-varid'>elemIndex</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 136: </span>    <span class='hs-varid'>elemIndices</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 137: </span>    <span class='hs-varid'>count</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 138: </span>    <span class='hs-varid'>findIndex</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 139: </span>    <span class='hs-varid'>findIndices</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 140: </span>    <span class='hs-varid'>unsafeIndex</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 141: </span>
<span class=hs-linenum> 142: </span>    <span class='hs-comment'>-- * Low level operations</span>
<span class=hs-linenum> 143: </span>    <span class='hs-varid'>createFromPtr</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 144: </span>    <span class='hs-varid'>copyToPtr</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 145: </span>
<span class=hs-linenum> 146: </span>    <span class='hs-comment'>-- ** Encoding validation</span>
<span class=hs-linenum> 147: </span>    <span class='hs-varid'>isValidUtf8</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 148: </span>
<span class=hs-linenum> 149: </span>    <span class='hs-comment'>-- * Low level conversions</span>
<span class=hs-linenum> 150: </span>    <span class='hs-comment'>-- ** Packing 'Foreign.C.String.CString's and pointers</span>
<span class=hs-linenum> 151: </span>    <span class='hs-varid'>packCString</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 152: </span>    <span class='hs-varid'>packCStringLen</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 153: </span>
<span class=hs-linenum> 154: </span>    <span class='hs-comment'>-- ** Using ShortByteStrings as 'Foreign.C.String.CString's</span>
<span class=hs-linenum> 155: </span>    <span class='hs-varid'>useAsCString</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 156: </span>    <span class='hs-varid'>useAsCStringLen</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 157: </span>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 158: </span>
<span class=hs-linenum> 159: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.ByteString.Internal.Type</span>
<span class=hs-linenum> 160: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>ByteString</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 161: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>unsafeDupablePerformIO</span>
<span class=hs-linenum> 162: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>accursedUnutterablePerformIO</span>
<span class=hs-linenum> 163: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>checkedAdd</span>
<span class=hs-linenum> 164: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>c_elem_index</span>
<span class=hs-linenum> 165: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>cIsValidUtf8BASafe</span>
<span class=hs-linenum> 166: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>cIsValidUtf8BA</span>
<span class=hs-linenum> 167: </span>  <span class='hs-layout'>)</span>
<span class=hs-linenum> 168: </span>
<span class=hs-linenum> 169: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Array.Byte</span>
<span class=hs-linenum> 170: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>ByteArray</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>MutableByteArray</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 171: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Bits</span>
<span class=hs-linenum> 172: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>FiniteBits</span> <span class='hs-layout'>(</span><span class='hs-varid'>finiteBitSize</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 173: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>shiftL</span>
<span class=hs-linenum> 174: </span><span class='hs-cpp'>#if HS_UNALIGNED_ByteArray_OPS_OK</span>
<span class=hs-linenum> 175: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>shiftR</span>
<span class=hs-linenum> 176: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum> 177: </span>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>.&amp;.</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 178: </span>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>.|.</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 179: </span>  <span class='hs-layout'>)</span>
<span class=hs-linenum> 180: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Data</span>
<span class=hs-linenum> 181: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>Data</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 182: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Monoid</span>
<span class=hs-linenum> 183: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>Monoid</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 184: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Semigroup</span>
<span class=hs-linenum> 185: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>Semigroup</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>stimesMonoid</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 186: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.List.NonEmpty</span>
<span class=hs-linenum> 187: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>NonEmpty</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 188: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.String</span>
<span class=hs-linenum> 189: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>IsString</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 190: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Applicative</span>
<span class=hs-linenum> 191: </span>  <span class='hs-layout'>(</span> <span class='hs-varid'>pure</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 192: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.DeepSeq</span>
<span class=hs-linenum> 193: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>NFData</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 194: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Exception</span>
<span class=hs-linenum> 195: </span>  <span class='hs-layout'>(</span> <span class='hs-varid'>assert</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 196: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Monad</span>
<span class=hs-linenum> 197: </span>  <span class='hs-layout'>(</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 198: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign.C.String</span>
<span class=hs-linenum> 199: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>CString</span>
<span class=hs-linenum> 200: </span>  <span class='hs-layout'>,</span> <span class='hs-conid'>CStringLen</span>
<span class=hs-linenum> 201: </span>  <span class='hs-layout'>)</span>
<span class=hs-linenum> 202: </span><span class='hs-cpp'>#if !HS_compareByteArrays_PRIMOP_AVAILABLE &amp;&amp; !PURE_HASKELL</span>
<span class=hs-linenum> 203: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign.C.Types</span>
<span class=hs-linenum> 204: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>CSize</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 205: </span>  <span class='hs-layout'>,</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 206: </span>  <span class='hs-layout'>)</span>
<span class=hs-linenum> 207: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum> 208: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign.Marshal.Alloc</span>
<span class=hs-linenum> 209: </span>  <span class='hs-layout'>(</span> <span class='hs-varid'>allocaBytes</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 210: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign.Storable</span>
<span class=hs-linenum> 211: </span>  <span class='hs-layout'>(</span> <span class='hs-varid'>pokeByteOff</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 212: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Exts</span>
<span class=hs-linenum> 213: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>Int</span><span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-cpp'>#</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ptr</span><span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Addr</span><span class='hs-cpp'>#</span><span class='hs-layout'>,</span> <span class='hs-conid'>Char</span><span class='hs-layout'>(</span><span class='hs-conid'>C</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 214: </span>  <span class='hs-layout'>,</span> <span class='hs-conid'>State</span><span class='hs-cpp'>#</span><span class='hs-layout'>,</span> <span class='hs-conid'>RealWorld</span>
<span class=hs-linenum> 215: </span>  <span class='hs-layout'>,</span> <span class='hs-conid'>ByteArray</span><span class='hs-cpp'>#</span><span class='hs-layout'>,</span> <span class='hs-conid'>MutableByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 216: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>newByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 217: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>byteArrayContents</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 218: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>unsafeCoerce</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 219: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>copyMutableByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 220: </span><span class='hs-cpp'>#if HS_isByteArrayPinned_PRIMOP_AVAILABLE</span>
<span class=hs-linenum> 221: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>isByteArrayPinned</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 222: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>isTrue</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 223: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum> 224: </span><span class='hs-cpp'>#if HS_compareByteArrays_PRIMOP_AVAILABLE</span>
<span class=hs-linenum> 225: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>compareByteArrays</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 226: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum> 227: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>sizeofByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 228: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>indexWord8Array</span><span class='hs-cpp'>#</span><span class='hs-layout'>,</span> <span class='hs-varid'>indexCharArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 229: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>writeWord8Array</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 230: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>unsafeFreezeByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 231: </span><span class='hs-cpp'>#if HS_UNALIGNED_ByteArray_OPS_OK</span>
<span class=hs-linenum> 232: </span>  <span class='hs-layout'>,</span><span class='hs-varid'>writeWord64Array</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 233: </span>  <span class='hs-layout'>,</span><span class='hs-varid'>indexWord8ArrayAsWord64</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 234: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum> 235: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>setByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 236: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>sizeofByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 237: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>indexWord8Array</span><span class='hs-cpp'>#</span><span class='hs-layout'>,</span> <span class='hs-varid'>indexCharArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 238: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>writeWord8Array</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 239: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>unsafeFreezeByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 240: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>touch</span><span class='hs-cpp'>#</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 241: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Generics</span>
<span class=hs-linenum> 242: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>Generic</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 243: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.IO</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span> <span class='hs-varid'>unsafeDupablePerformIO</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 244: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.ForeignPtr</span>
<span class=hs-linenum> 245: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>ForeignPtr</span><span class='hs-layout'>(</span><span class='hs-conid'>ForeignPtr</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 246: </span>  <span class='hs-layout'>,</span> <span class='hs-conid'>ForeignPtrContents</span><span class='hs-layout'>(</span><span class='hs-conid'>PlainPtr</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 247: </span>  <span class='hs-layout'>)</span>
<span class=hs-linenum> 248: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.ST</span>
<span class=hs-linenum> 249: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>ST</span><span class='hs-layout'>(</span><span class='hs-conid'>ST</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 250: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>runST</span>
<span class=hs-linenum> 251: </span>  <span class='hs-layout'>)</span>
<span class=hs-linenum> 252: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Stack.Types</span>
<span class=hs-linenum> 253: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-layout'>)</span>
<span class=hs-linenum> 254: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Word</span>
<span class=hs-linenum> 255: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span>
<span class=hs-linenum> 256: </span>  <span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ordering</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 257: </span>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>$!</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>error</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>++</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>||</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 258: </span>  <span class='hs-layout'>,</span> <span class='hs-conid'>String</span><span class='hs-layout'>,</span> <span class='hs-varid'>userError</span>
<span class=hs-linenum> 259: </span>  <span class='hs-layout'>,</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&amp;&amp;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>otherwise</span>
<span class=hs-linenum> 260: </span>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>fromIntegral</span>
<span class=hs-linenum> 261: </span>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 262: </span>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>^</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 263: </span>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;$&gt;</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 264: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>return</span>
<span class=hs-linenum> 265: </span>  <span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 266: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>not</span>
<span class=hs-linenum> 267: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>snd</span>
<span class=hs-linenum> 268: </span>  <span class='hs-layout'>)</span>
<span class=hs-linenum> 269: </span>
<span class=hs-linenum> 270: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data.ByteString.Internal.Type</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>BS</span>
<span class=hs-linenum> 271: </span>
<span class=hs-linenum> 272: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data.List</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>List</span>
<span class=hs-linenum> 273: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>GHC.Exts</span>
<span class=hs-linenum> 274: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Language.Haskell.TH.Syntax</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>TH</span>
<span class=hs-linenum> 275: </span>
<span class=hs-linenum> 276: </span><span class='hs-comment'>-- | A compact representation of a 'Word8' vector.</span>
<span class=hs-linenum> 277: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 278: </span><span class='hs-comment'>-- It has a lower memory overhead than a 'ByteString' and does not</span>
<span class=hs-linenum> 279: </span><span class='hs-comment'>-- contribute to heap fragmentation. It can be converted to or from a</span>
<span class=hs-linenum> 280: </span><span class='hs-comment'>-- 'ByteString' (at the cost of copying the string data). It supports very few</span>
<span class=hs-linenum> 281: </span><span class='hs-comment'>-- other operations.</span>
<span class=hs-linenum> 282: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 283: </span><span class='hs-keyword'>newtype</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum> 284: </span>  <span class='hs-comment'>-- | @since 0.12.0.0</span>
<span class=hs-linenum> 285: </span>  <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 286: </span>  <span class='hs-layout'>{</span> <span class='hs-varid'>unShortByteString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span>
<span class=hs-linenum> 287: </span>  <span class='hs-comment'>-- ^ @since 0.12.0.0</span>
<span class=hs-linenum> 288: </span>  <span class='hs-layout'>}</span>
<span class=hs-linenum> 289: </span>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>TH.Lift</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Generic</span><span class='hs-layout'>,</span> <span class='hs-conid'>NFData</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 290: </span>
<span class=hs-linenum> 291: </span><span class='hs-comment'>-- | Prior to @bytestring-0.12@ 'SBS' was a genuine constructor of 'ShortByteString',</span>
<span class=hs-linenum> 292: </span><span class='hs-comment'>-- but now it is a bundled pattern synonym, provided as a compatibility shim.</span>
<span class=hs-linenum> 293: </span><span class='hs-definition'>pattern</span> <span class='hs-conid'>SBS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 294: </span><span class='hs-definition'>pattern</span> <span class='hs-conid'>SBS</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 295: </span><span class='hs-cpp'>#if __GLASGOW_HASKELL__ &gt;= 802</span>
<span class=hs-linenum> 296: </span><span class='hs-comment'>{-# COMPLETE SBS #-}</span>
<span class=hs-linenum> 297: </span><span class='hs-comment'>-- To avoid spurious warnings from CI with ghc-8.0, we internally</span>
<span class=hs-linenum> 298: </span><span class='hs-comment'>-- use view patterns like (unSBS -&gt; ba#) instead of using (SBS ba#)</span>
<span class=hs-linenum> 299: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum> 300: </span>
<span class=hs-linenum> 301: </span><span class='hs-comment'>-- | Lexicographic order.</span>
<span class=hs-linenum> 302: </span><span class='hs-keyword'>instance</span> <span class='hs-conid'>Ord</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 303: </span>    <span class='hs-varid'>compare</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>compareBytes</span>
<span class=hs-linenum> 304: </span>
<span class=hs-linenum> 305: </span><span class='hs-comment'>-- Instead of deriving Semigroup / Monoid , we stick to our own implementations</span>
<span class=hs-linenum> 306: </span><span class='hs-comment'>-- of mappend / mconcat, because they are safer with regards to overflows</span>
<span class=hs-linenum> 307: </span><span class='hs-comment'>-- (see prop_32bitOverflow_Short_mconcat test).</span>
<span class=hs-linenum> 308: </span><span class='hs-comment'>-- ByteArray is likely to catch up starting from GHC 9.6:</span>
<span class=hs-linenum> 309: </span><span class='hs-comment'>-- * https://gitlab.haskell.org/ghc/ghc/-/merge_requests/8272</span>
<span class=hs-linenum> 310: </span><span class='hs-comment'>-- * https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9128</span>
<span class=hs-linenum> 311: </span>
<span class=hs-linenum> 312: </span><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 313: </span>    <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>append</span>
<span class=hs-linenum> 314: </span>    <span class='hs-varid'>sconcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-conop'>:|</span><span class='hs-varid'>bs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concat</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-varid'>bs</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 315: </span>    <span class='hs-varid'>stimes</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stimesMonoid</span>
<span class=hs-linenum> 316: </span>
<span class=hs-linenum> 317: </span><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monoid</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 318: </span>    <span class='hs-varid'>mempty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<span class=hs-linenum> 319: </span>    <span class='hs-varid'>mappend</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 320: </span>    <span class='hs-varid'>mconcat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concat</span>
<span class=hs-linenum> 321: </span>
<span class=hs-linenum> 322: </span><span class='hs-keyword'>instance</span> <span class='hs-conid'>Show</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 323: </span>    <span class='hs-varid'>showsPrec</span> <span class='hs-varid'>p</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>showsPrec</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>unpackChars</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span>
<span class=hs-linenum> 324: </span>
<span class=hs-linenum> 325: </span><span class='hs-keyword'>instance</span> <span class='hs-conid'>Read</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 326: </span>    <span class='hs-varid'>readsPrec</span> <span class='hs-varid'>p</span> <span class='hs-varid'>str</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span> <span class='hs-layout'>(</span><span class='hs-varid'>packChars</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>readsPrec</span> <span class='hs-varid'>p</span> <span class='hs-varid'>str</span> <span class='hs-keyglyph'>]</span>
<span class=hs-linenum> 327: </span>
<span class=hs-linenum> 328: </span><span class='hs-comment'>-- | @since 0.10.12.0</span>
<span class=hs-linenum> 329: </span><span class='hs-keyword'>instance</span> <span class='hs-conid'>GHC.Exts.IsList</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 330: </span>  <span class='hs-keyword'>type</span> <span class='hs-conid'>Item</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 331: </span>  <span class='hs-varid'>fromList</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-varop'>.</span> <span class='hs-conid'>GHC.Exts.fromList</span>
<span class=hs-linenum> 332: </span>  <span class='hs-varid'>fromListN</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span> <span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-conid'>GHC.Exts.fromListN</span>
<span class=hs-linenum> 333: </span>  <span class='hs-varid'>toList</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GHC.Exts.toList</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unShortByteString</span>
<span class=hs-linenum> 334: </span>
<span class=hs-linenum> 335: </span><span class='hs-comment'>-- | Beware: 'fromString' truncates multi-byte characters to octets.</span>
<span class=hs-linenum> 336: </span><span class='hs-comment'>-- e.g. "枯朶に烏のとまりけり秋の暮" becomes �6k�nh~�Q��n�</span>
<span class=hs-linenum> 337: </span><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsString</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 338: </span>    <span class='hs-varid'>fromString</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>packChars</span>
<span class=hs-linenum> 339: </span>
<span class=hs-linenum> 340: </span><span class='hs-comment'>------------------------------------------------------------------------</span>
<span class=hs-linenum> 341: </span><span class='hs-comment'>-- Simple operations</span>
<span class=hs-linenum> 342: </span>
<span class=hs-linenum> 343: </span><span class='hs-comment'>-- | /O(1)/. The empty 'ShortByteString'.</span>
<span class=hs-linenum> 344: </span><span class='hs-definition'>empty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 345: </span><span class='hs-definition'>empty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>create</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 346: </span>
<span class=hs-linenum> 347: </span><span class='hs-comment'>-- | /O(1)/ The length of a 'ShortByteString'.</span>
<span class=hs-linenum> 348: </span><span class='hs-definition'>length</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum> 349: </span><span class='hs-definition'>length</span> <span class='hs-layout'>(</span><span class='hs-varid'>unSBS</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>barr</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>sizeofByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>barr</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 350: </span>
<span class=hs-linenum> 351: </span><span class='hs-comment'>-- | /O(1)/ Test whether a 'ShortByteString' is empty.</span>
<span class=hs-linenum> 352: </span><span class='hs-definition'>null</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum> 353: </span><span class='hs-definition'>null</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span>
<span class=hs-linenum> 354: </span>
<span class=hs-linenum> 355: </span><span class='hs-comment'>-- | /O(1)/ 'ShortByteString' index (subscript) operator, starting from 0.</span>
<span class=hs-linenum> 356: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 357: </span><span class='hs-comment'>-- This is a partial function, consider using 'indexMaybe' instead.</span>
<span class=hs-linenum> 358: </span><span class='hs-definition'>index</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 359: </span><span class='hs-definition'>index</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 360: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>0</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafeIndex</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 361: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexError</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 362: </span>
<span class=hs-linenum> 363: </span><span class='hs-comment'>-- | /O(1)/ 'ShortByteString' index, starting from 0, that returns 'Just' if:</span>
<span class=hs-linenum> 364: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 365: </span><span class='hs-comment'>-- &gt; 0 &lt;= n &lt; length bs</span>
<span class=hs-linenum> 366: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 367: </span><span class='hs-comment'>-- @since 0.11.0.0</span>
<span class=hs-linenum> 368: </span><span class='hs-definition'>indexMaybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 369: </span><span class='hs-definition'>indexMaybe</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 370: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>0</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$!</span> <span class='hs-varid'>unsafeIndex</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 371: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<span class=hs-linenum> 372: </span><span class='hs-comment'>{-# INLINE indexMaybe #-}</span>
<span class=hs-linenum> 373: </span>
<span class=hs-linenum> 374: </span><span class='hs-comment'>-- | /O(1)/ 'ShortByteString' index, starting from 0, that returns 'Just' if:</span>
<span class=hs-linenum> 375: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 376: </span><span class='hs-comment'>-- &gt; 0 &lt;= n &lt; length bs</span>
<span class=hs-linenum> 377: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 378: </span><span class='hs-comment'>-- @since 0.11.0.0</span>
<span class=hs-linenum> 379: </span><span class='hs-layout'>(</span><span class='hs-varop'>!?</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 380: </span><span class='hs-layout'>(</span><span class='hs-varop'>!?</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexMaybe</span>
<span class=hs-linenum> 381: </span><span class='hs-comment'>{-# INLINE (!?) #-}</span>
<span class=hs-linenum> 382: </span>
<span class=hs-linenum> 383: </span><span class='hs-comment'>-- | /O(1)/ Unsafe indexing without bounds checking.</span>
<span class=hs-linenum> 384: </span><span class='hs-definition'>unsafeIndex</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 385: </span><span class='hs-definition'>unsafeIndex</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 386: </span>
<span class=hs-linenum> 387: </span><span class='hs-definition'>indexError</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<span class=hs-linenum> 388: </span><span class='hs-definition'>indexError</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum> 389: </span>  <span class='hs-varid'>moduleError</span> <span class='hs-str'>"index"</span> <span class='hs-varop'>$</span> <span class='hs-str'>"error in array index: "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 390: </span>                        <span class='hs-varop'>++</span> <span class='hs-str'>" not in range [0.."</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span> <span class='hs-str'>"]"</span>
<span class=hs-linenum> 391: </span>
<span class=hs-linenum> 392: </span><span class='hs-comment'>------------------------------------------------------------------------</span>
<span class=hs-linenum> 393: </span><span class='hs-comment'>-- Internal utils</span>
<span class=hs-linenum> 394: </span>
<span class=hs-linenum> 395: </span><span class='hs-definition'>asBA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteArray</span>
<span class=hs-linenum> 396: </span><span class='hs-definition'>asBA</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span> <span class='hs-varid'>ba</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ba</span>
<span class=hs-linenum> 397: </span>
<span class=hs-linenum> 398: </span><span class='hs-definition'>unSBS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 399: </span><span class='hs-definition'>unSBS</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span>
<span class=hs-linenum> 400: </span>
<span class=hs-linenum> 401: </span><span class='hs-definition'>create</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>s</span><span class='hs-varop'>.</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 402: </span><span class='hs-definition'>create</span> <span class='hs-varid'>len</span> <span class='hs-varid'>fill</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum> 403: </span>    <span class='hs-varid'>assert</span> <span class='hs-layout'>(</span><span class='hs-varid'>len</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runST</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 404: </span>      <span class='hs-varid'>mba</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newByteArray</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 405: </span>      <span class='hs-varid'>fill</span> <span class='hs-varid'>mba</span>
<span class=hs-linenum> 406: </span>      <span class='hs-conid'>ShortByteString</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>unsafeFreezeByteArray</span> <span class='hs-varid'>mba</span>
<span class=hs-linenum> 407: </span><span class='hs-comment'>{-# INLINE create #-}</span>
<span class=hs-linenum> 408: </span>
<span class=hs-linenum> 409: </span><span class='hs-comment'>-- | Given the maximum size needed and a function to make the contents</span>
<span class=hs-linenum> 410: </span><span class='hs-comment'>-- of a ShortByteString, createAndTrim makes the 'ShortByteString'.</span>
<span class=hs-linenum> 411: </span><span class='hs-comment'>-- The generating function is required to return the actual final size</span>
<span class=hs-linenum> 412: </span><span class='hs-comment'>-- (&lt;= the maximum size) and the result value. The resulting byte array</span>
<span class=hs-linenum> 413: </span><span class='hs-comment'>-- is realloced to this size.</span>
<span class=hs-linenum> 414: </span><span class='hs-definition'>createAndTrim</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>s</span><span class='hs-varop'>.</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 415: </span><span class='hs-definition'>createAndTrim</span> <span class='hs-varid'>maxLen</span> <span class='hs-varid'>fill</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum> 416: </span>    <span class='hs-varid'>assert</span> <span class='hs-layout'>(</span><span class='hs-varid'>maxLen</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runST</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 417: </span>      <span class='hs-varid'>mba</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newByteArray</span> <span class='hs-varid'>maxLen</span>
<span class=hs-linenum> 418: </span>      <span class='hs-layout'>(</span><span class='hs-varid'>len</span><span class='hs-layout'>,</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>fill</span> <span class='hs-varid'>mba</span>
<span class=hs-linenum> 419: </span>      <span class='hs-keyword'>if</span> <span class='hs-varid'>assert</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>maxLen</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>maxLen</span>
<span class=hs-linenum> 420: </span>          <span class='hs-keyword'>then</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 421: </span>            <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>unsafeFreezeByteArray</span> <span class='hs-varid'>mba</span>
<span class=hs-linenum> 422: </span>            <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span> <span class='hs-varid'>ba</span><span class='hs-layout'>,</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 423: </span>          <span class='hs-keyword'>else</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 424: </span>            <span class='hs-varid'>mba2</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newByteArray</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 425: </span>            <span class='hs-varid'>copyMutableByteArray</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba2</span> <span class='hs-num'>0</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 426: </span>            <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>unsafeFreezeByteArray</span> <span class='hs-varid'>mba2</span>
<span class=hs-linenum> 427: </span>            <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span> <span class='hs-varid'>ba</span><span class='hs-layout'>,</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 428: </span><span class='hs-comment'>{-# INLINE createAndTrim #-}</span>
<span class=hs-linenum> 429: </span>
<span class=hs-linenum> 430: </span><span class='hs-definition'>createAndTrim'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>s</span><span class='hs-varop'>.</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 431: </span><span class='hs-definition'>createAndTrim'</span> <span class='hs-varid'>maxLen</span> <span class='hs-varid'>fill</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum> 432: </span>    <span class='hs-varid'>assert</span> <span class='hs-layout'>(</span><span class='hs-varid'>maxLen</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runST</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 433: </span>      <span class='hs-varid'>mba</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newByteArray</span> <span class='hs-varid'>maxLen</span>
<span class=hs-linenum> 434: </span>      <span class='hs-varid'>len</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>fill</span> <span class='hs-varid'>mba</span>
<span class=hs-linenum> 435: </span>      <span class='hs-keyword'>if</span> <span class='hs-varid'>assert</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>maxLen</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>maxLen</span>
<span class=hs-linenum> 436: </span>          <span class='hs-keyword'>then</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 437: </span>            <span class='hs-conid'>ShortByteString</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>unsafeFreezeByteArray</span> <span class='hs-varid'>mba</span>
<span class=hs-linenum> 438: </span>          <span class='hs-keyword'>else</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 439: </span>            <span class='hs-varid'>mba2</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newByteArray</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 440: </span>            <span class='hs-varid'>copyMutableByteArray</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba2</span> <span class='hs-num'>0</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 441: </span>            <span class='hs-conid'>ShortByteString</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>unsafeFreezeByteArray</span> <span class='hs-varid'>mba2</span>
<span class=hs-linenum> 442: </span><span class='hs-comment'>{-# INLINE createAndTrim' #-}</span>
<span class=hs-linenum> 443: </span>
<span class=hs-linenum> 444: </span><span class='hs-comment'>-- | Like createAndTrim, but with two buffers at once</span>
<span class=hs-linenum> 445: </span><span class='hs-definition'>createAndTrim2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>s</span><span class='hs-varop'>.</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 446: </span><span class='hs-definition'>createAndTrim2</span> <span class='hs-varid'>maxLen1</span> <span class='hs-varid'>maxLen2</span> <span class='hs-varid'>fill</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum> 447: </span>    <span class='hs-varid'>runST</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 448: </span>      <span class='hs-varid'>mba1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newByteArray</span> <span class='hs-varid'>maxLen1</span>
<span class=hs-linenum> 449: </span>      <span class='hs-varid'>mba2</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newByteArray</span> <span class='hs-varid'>maxLen2</span>
<span class=hs-linenum> 450: </span>      <span class='hs-layout'>(</span><span class='hs-varid'>len1</span><span class='hs-layout'>,</span> <span class='hs-varid'>len2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>fill</span> <span class='hs-varid'>mba1</span> <span class='hs-varid'>mba2</span>
<span class=hs-linenum> 451: </span>      <span class='hs-varid'>sbs1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>freeze'</span> <span class='hs-varid'>len1</span> <span class='hs-varid'>maxLen1</span> <span class='hs-varid'>mba1</span>
<span class=hs-linenum> 452: </span>      <span class='hs-varid'>sbs2</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>freeze'</span> <span class='hs-varid'>len2</span> <span class='hs-varid'>maxLen2</span> <span class='hs-varid'>mba2</span>
<span class=hs-linenum> 453: </span>      <span class='hs-varid'>pure</span> <span class='hs-layout'>(</span><span class='hs-varid'>sbs1</span><span class='hs-layout'>,</span> <span class='hs-varid'>sbs2</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 454: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum> 455: </span>    <span class='hs-varid'>freeze'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 456: </span>    <span class='hs-varid'>freeze'</span> <span class='hs-varid'>len</span> <span class='hs-varid'>maxLen</span> <span class='hs-varid'>mba</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum> 457: </span>      <span class='hs-keyword'>if</span> <span class='hs-varid'>assert</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>maxLen</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>maxLen</span>
<span class=hs-linenum> 458: </span>          <span class='hs-keyword'>then</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 459: </span>            <span class='hs-conid'>ShortByteString</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>unsafeFreezeByteArray</span> <span class='hs-varid'>mba</span>
<span class=hs-linenum> 460: </span>          <span class='hs-keyword'>else</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 461: </span>            <span class='hs-varid'>mba2</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newByteArray</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 462: </span>            <span class='hs-varid'>copyMutableByteArray</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba2</span> <span class='hs-num'>0</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 463: </span>            <span class='hs-conid'>ShortByteString</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>unsafeFreezeByteArray</span> <span class='hs-varid'>mba2</span>
<span class=hs-linenum> 464: </span><span class='hs-comment'>{-# INLINE createAndTrim2 #-}</span>
<span class=hs-linenum> 465: </span>
<span class=hs-linenum> 466: </span><span class='hs-definition'>isPinned</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum> 467: </span><span class='hs-cpp'>#if HS_isByteArrayPinned_PRIMOP_AVAILABLE</span>
<span class=hs-linenum> 468: </span><span class='hs-definition'>isPinned</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isTrue</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>isByteArrayPinned</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 469: </span><span class='hs-cpp'>#else</span>
<span class=hs-linenum> 470: </span><span class='hs-definition'>isPinned</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<span class=hs-linenum> 471: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum> 472: </span>
<span class=hs-linenum> 473: </span><span class='hs-comment'>------------------------------------------------------------------------</span>
<span class=hs-linenum> 474: </span><span class='hs-comment'>-- Conversion to and from ByteString</span>
<span class=hs-linenum> 475: </span>
<span class=hs-linenum> 476: </span><span class='hs-comment'>-- | /O(n)/. Convert a 'ByteString' into a 'ShortByteString'.</span>
<span class=hs-linenum> 477: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 478: </span><span class='hs-comment'>-- This makes a copy, so does not retain the input string.</span>
<span class=hs-linenum> 479: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 480: </span><span class='hs-definition'>toShort</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 481: </span><span class='hs-definition'>toShort</span> <span class='hs-varop'>!</span><span class='hs-varid'>bs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafeDupablePerformIO</span> <span class='hs-layout'>(</span><span class='hs-varid'>toShortIO</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 482: </span>
<span class=hs-linenum> 483: </span><span class='hs-definition'>toShortIO</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 484: </span><span class='hs-definition'>toShortIO</span> <span class='hs-layout'>(</span><span class='hs-conid'>BS</span> <span class='hs-varid'>fptr</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 485: </span>    <span class='hs-varid'>mba</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>stToIO</span> <span class='hs-layout'>(</span><span class='hs-varid'>newByteArray</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 486: </span>    <span class='hs-conid'>BS.unsafeWithForeignPtr</span> <span class='hs-varid'>fptr</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ptr</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 487: </span>      <span class='hs-varid'>stToIO</span> <span class='hs-layout'>(</span><span class='hs-varid'>copyAddrToByteArray</span> <span class='hs-varid'>ptr</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 488: </span>    <span class='hs-conid'>ShortByteString</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>stToIO</span> <span class='hs-layout'>(</span><span class='hs-varid'>unsafeFreezeByteArray</span> <span class='hs-varid'>mba</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 489: </span>
<span class=hs-linenum> 490: </span><span class='hs-comment'>-- | /O(n)/. Convert a 'ShortByteString' into a 'ByteString'.</span>
<span class=hs-linenum> 491: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 492: </span><span class='hs-definition'>fromShort</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span>
<span class=hs-linenum> 493: </span><span class='hs-definition'>fromShort</span> <span class='hs-varid'>sbs</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>unSBS</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 494: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isPinned</span> <span class='hs-varid'>b</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BS</span> <span class='hs-varid'>inPlaceFp</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 495: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BS.unsafeCreateFp</span> <span class='hs-varid'>len</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>fp</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 496: </span>      <span class='hs-conid'>BS.unsafeWithForeignPtr</span> <span class='hs-varid'>fp</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyToPtr</span> <span class='hs-varid'>sbs</span> <span class='hs-num'>0</span> <span class='hs-varid'>p</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 497: </span>    <span class='hs-keyword'>where</span>
<span class=hs-linenum> 498: </span>      <span class='hs-varid'>inPlaceFp</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ForeignPtr</span> <span class='hs-layout'>(</span><span class='hs-varid'>byteArrayContents</span><span class='hs-cpp'>#</span> <span class='hs-varid'>b</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 499: </span>                             <span class='hs-layout'>(</span><span class='hs-conid'>PlainPtr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unsafeCoerce</span><span class='hs-cpp'>#</span> <span class='hs-varid'>b</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 500: </span>      <span class='hs-varid'>len</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>sizeofByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>b</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 501: </span>
<span class=hs-linenum> 502: </span><span class='hs-comment'>-- | /O(1)/ Convert a 'Word8' into a 'ShortByteString'</span>
<span class=hs-linenum> 503: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 504: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 505: </span><span class='hs-definition'>singleton</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 506: </span><span class='hs-definition'>singleton</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>w</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>create</span> <span class='hs-num'>1</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 507: </span>
<span class=hs-linenum> 508: </span><span class='hs-comment'>------------------------------------------------------------------------</span>
<span class=hs-linenum> 509: </span><span class='hs-comment'>-- Packing and unpacking from lists</span>
<span class=hs-linenum> 510: </span>
<span class=hs-linenum> 511: </span><span class='hs-comment'>-- | /O(n)/. Convert a list into a 'ShortByteString'</span>
<span class=hs-linenum> 512: </span><span class='hs-definition'>pack</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 513: </span><span class='hs-definition'>pack</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>packBytes</span>
<span class=hs-linenum> 514: </span>
<span class=hs-linenum> 515: </span><span class='hs-comment'>-- | /O(n)/. Convert a 'ShortByteString' into a list.</span>
<span class=hs-linenum> 516: </span><span class='hs-definition'>unpack</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum> 517: </span><span class='hs-definition'>unpack</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GHC.Exts.build</span> <span class='hs-layout'>(</span><span class='hs-varid'>unpackFoldr</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 518: </span><span class='hs-comment'>{-# INLINE unpack #-}</span>
<span class=hs-linenum> 519: </span>
<span class=hs-linenum> 520: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 521: </span><span class='hs-comment'>-- Have unpack fuse with good list consumers</span>
<span class=hs-linenum> 522: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 523: </span><span class='hs-definition'>unpackFoldr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<span class=hs-linenum> 524: </span><span class='hs-definition'>unpackFoldr</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>k</span> <span class='hs-varid'>z</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>k</span> <span class='hs-varid'>z</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 525: </span><span class='hs-comment'>{-# INLINE [0] unpackFoldr #-}</span>
<span class=hs-linenum> 526: </span>
<span class=hs-linenum> 527: </span><span class='hs-comment'>{-# RULES
"ShortByteString unpack-list" [1]  forall bs .
    unpackFoldr bs (:) [] = unpackBytes bs
 #-}</span>
<span class=hs-linenum> 531: </span>
<span class=hs-linenum> 532: </span><span class='hs-definition'>packChars</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Char</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 533: </span><span class='hs-definition'>packChars</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>cs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>packLenBytes</span> <span class='hs-layout'>(</span><span class='hs-conid'>List.length</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>List.map</span> <span class='hs-conid'>BS.c2w</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 534: </span>
<span class=hs-linenum> 535: </span><span class='hs-definition'>packBytes</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 536: </span><span class='hs-definition'>packBytes</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ws</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>packLenBytes</span> <span class='hs-layout'>(</span><span class='hs-conid'>List.length</span> <span class='hs-varid'>ws</span><span class='hs-layout'>)</span> <span class='hs-varid'>ws</span>
<span class=hs-linenum> 537: </span>
<span class=hs-linenum> 538: </span><span class='hs-definition'>packLenBytes</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 539: </span><span class='hs-definition'>packLenBytes</span> <span class='hs-varid'>len</span> <span class='hs-varid'>ws0</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum> 540: </span>    <span class='hs-varid'>create</span> <span class='hs-varid'>len</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>ws0</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 541: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum> 542: </span>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 543: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-keyword'>_</span>   <span class='hs-varop'>!</span><span class='hs-keyword'>_</span> <span class='hs-conid'>[]</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 544: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>mba</span> <span class='hs-varop'>!</span><span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span><span class='hs-conop'>:</span><span class='hs-varid'>ws</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 545: </span>      <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba</span> <span class='hs-varid'>i</span> <span class='hs-varid'>w</span>
<span class=hs-linenum> 546: </span>      <span class='hs-varid'>go</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>ws</span>
<span class=hs-linenum> 547: </span>
<span class=hs-linenum> 548: </span><span class='hs-comment'>-- Unpacking bytestrings into lists efficiently is a tradeoff: on the one hand</span>
<span class=hs-linenum> 549: </span><span class='hs-comment'>-- we would like to write a tight loop that just blats the list into memory, on</span>
<span class=hs-linenum> 550: </span><span class='hs-comment'>-- the other hand we want it to be unpacked lazily so we don't end up with a</span>
<span class=hs-linenum> 551: </span><span class='hs-comment'>-- massive list data structure in memory.</span>
<span class=hs-linenum> 552: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 553: </span><span class='hs-comment'>-- Our strategy is to combine both: we will unpack lazily in reasonable sized</span>
<span class=hs-linenum> 554: </span><span class='hs-comment'>-- chunks, where each chunk is unpacked strictly.</span>
<span class=hs-linenum> 555: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 556: </span><span class='hs-comment'>-- unpackChars does the lazy loop, while unpackAppendBytes and</span>
<span class=hs-linenum> 557: </span><span class='hs-comment'>-- unpackAppendChars do the chunks strictly.</span>
<span class=hs-linenum> 558: </span>
<span class=hs-linenum> 559: </span><span class='hs-definition'>unpackChars</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Char</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum> 560: </span><span class='hs-definition'>unpackChars</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpackAppendCharsLazy</span> <span class='hs-varid'>sbs</span> <span class='hs-conid'>[]</span>
<span class=hs-linenum> 561: </span>
<span class=hs-linenum> 562: </span><span class='hs-definition'>unpackBytes</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum> 563: </span><span class='hs-definition'>unpackBytes</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpackAppendBytesLazy</span> <span class='hs-varid'>sbs</span> <span class='hs-conid'>[]</span>
<span class=hs-linenum> 564: </span>
<span class=hs-linenum> 565: </span>
<span class=hs-linenum> 566: </span><span class='hs-comment'>-- Why 100 bytes you ask? Because on a 64bit machine the list we allocate</span>
<span class=hs-linenum> 567: </span><span class='hs-comment'>-- takes just shy of 4k which seems like a reasonable amount.</span>
<span class=hs-linenum> 568: </span><span class='hs-comment'>-- (5 words per list element, 8 bytes per word, 100 elements = 4000 bytes)</span>
<span class=hs-linenum> 569: </span>
<span class=hs-linenum> 570: </span><span class='hs-definition'>unpackAppendCharsLazy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Char</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Char</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum> 571: </span><span class='hs-definition'>unpackAppendCharsLazy</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 572: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum> 573: </span>    <span class='hs-varid'>sz</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>100</span>
<span class=hs-linenum> 574: </span>
<span class=hs-linenum> 575: </span>    <span class='hs-varid'>go</span> <span class='hs-varid'>off</span> <span class='hs-varid'>len</span> <span class='hs-varid'>cs</span>
<span class=hs-linenum> 576: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>sz</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpackAppendCharsStrict</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>off</span> <span class='hs-varid'>len</span> <span class='hs-varid'>cs</span>
<span class=hs-linenum> 577: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpackAppendCharsStrict</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>off</span> <span class='hs-varid'>sz</span>  <span class='hs-varid'>remainder</span>
<span class=hs-linenum> 578: </span>                      <span class='hs-keyword'>where</span> <span class='hs-varid'>remainder</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>off</span><span class='hs-varop'>+</span><span class='hs-varid'>sz</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>len</span><span class='hs-comment'>-</span><span class='hs-varid'>sz</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span>
<span class=hs-linenum> 579: </span>
<span class=hs-linenum> 580: </span><span class='hs-definition'>unpackAppendBytesLazy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum> 581: </span><span class='hs-definition'>unpackAppendBytesLazy</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 582: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum> 583: </span>    <span class='hs-varid'>sz</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>100</span>
<span class=hs-linenum> 584: </span>
<span class=hs-linenum> 585: </span>    <span class='hs-varid'>go</span> <span class='hs-varid'>off</span> <span class='hs-varid'>len</span> <span class='hs-varid'>ws</span>
<span class=hs-linenum> 586: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>sz</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpackAppendBytesStrict</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>off</span> <span class='hs-varid'>len</span> <span class='hs-varid'>ws</span>
<span class=hs-linenum> 587: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpackAppendBytesStrict</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>off</span> <span class='hs-varid'>sz</span>  <span class='hs-varid'>remainder</span>
<span class=hs-linenum> 588: </span>                      <span class='hs-keyword'>where</span> <span class='hs-varid'>remainder</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>off</span><span class='hs-varop'>+</span><span class='hs-varid'>sz</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>len</span><span class='hs-comment'>-</span><span class='hs-varid'>sz</span><span class='hs-layout'>)</span> <span class='hs-varid'>ws</span>
<span class=hs-linenum> 589: </span>
<span class=hs-linenum> 590: </span><span class='hs-comment'>-- For these unpack functions, since we're unpacking the whole list strictly we</span>
<span class=hs-linenum> 591: </span><span class='hs-comment'>-- build up the result list in an accumulator. This means we have to build up</span>
<span class=hs-linenum> 592: </span><span class='hs-comment'>-- the list starting at the end. So our traversal starts at the end of the</span>
<span class=hs-linenum> 593: </span><span class='hs-comment'>-- buffer and loops down until we hit the sentinal:</span>
<span class=hs-linenum> 594: </span>
<span class=hs-linenum> 595: </span><span class='hs-definition'>unpackAppendCharsStrict</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Char</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Char</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum> 596: </span><span class='hs-definition'>unpackAppendCharsStrict</span> <span class='hs-varop'>!</span><span class='hs-varid'>sbs</span> <span class='hs-varid'>off</span> <span class='hs-varid'>len</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>off</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>off</span><span class='hs-comment'>-</span><span class='hs-num'>1</span> <span class='hs-varop'>+</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 597: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum> 598: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>sentinal</span> <span class='hs-varop'>!</span><span class='hs-varid'>i</span> <span class='hs-varid'>acc</span>
<span class=hs-linenum> 599: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-varid'>sentinal</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>acc</span>
<span class=hs-linenum> 600: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>     <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varop'>!</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexCharArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 601: </span>                        <span class='hs-keyword'>in</span> <span class='hs-varid'>go</span> <span class='hs-varid'>sentinal</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-conop'>:</span><span class='hs-varid'>acc</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 602: </span>
<span class=hs-linenum> 603: </span><span class='hs-definition'>unpackAppendBytesStrict</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum> 604: </span><span class='hs-definition'>unpackAppendBytesStrict</span> <span class='hs-varop'>!</span><span class='hs-varid'>sbs</span> <span class='hs-varid'>off</span> <span class='hs-varid'>len</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>off</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>off</span><span class='hs-comment'>-</span><span class='hs-num'>1</span> <span class='hs-varop'>+</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 605: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum> 606: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>sentinal</span> <span class='hs-varop'>!</span><span class='hs-varid'>i</span> <span class='hs-varid'>acc</span>
<span class=hs-linenum> 607: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-varid'>sentinal</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>acc</span>
<span class=hs-linenum> 608: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>     <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varop'>!</span><span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 609: </span>                         <span class='hs-keyword'>in</span> <span class='hs-varid'>go</span> <span class='hs-varid'>sentinal</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span><span class='hs-conop'>:</span><span class='hs-varid'>acc</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 610: </span>
<span class=hs-linenum> 611: </span>
<span class=hs-linenum> 612: </span><span class='hs-comment'>------------------------------------------------------------------------</span>
<span class=hs-linenum> 613: </span><span class='hs-comment'>-- Eq and Ord implementations</span>
<span class=hs-linenum> 614: </span>
<span class=hs-linenum> 615: </span><span class='hs-definition'>compareBytes</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ordering</span>
<span class=hs-linenum> 616: </span><span class='hs-definition'>compareBytes</span> <span class='hs-varid'>sbs1</span> <span class='hs-varid'>sbs2</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum> 617: </span>    <span class='hs-keyword'>let</span> <span class='hs-varop'>!</span><span class='hs-varid'>len1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs1</span>
<span class=hs-linenum> 618: </span>        <span class='hs-varop'>!</span><span class='hs-varid'>len2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs2</span>
<span class=hs-linenum> 619: </span>        <span class='hs-varop'>!</span><span class='hs-varid'>len</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>min</span> <span class='hs-varid'>len1</span> <span class='hs-varid'>len2</span>
<span class=hs-linenum> 620: </span>     <span class='hs-keyword'>in</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>compareByteArrays</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs2</span><span class='hs-layout'>)</span> <span class='hs-varid'>len</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum> 621: </span>          <span class='hs-varid'>i</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span>    <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LT</span>
<span class=hs-linenum> 622: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span>    <span class='hs-varop'>&gt;</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GT</span>
<span class=hs-linenum> 623: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>len2</span> <span class='hs-varop'>&gt;</span> <span class='hs-varid'>len1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LT</span>
<span class=hs-linenum> 624: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>len2</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>len1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GT</span>
<span class=hs-linenum> 625: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EQ</span>
<span class=hs-linenum> 626: </span>
<span class=hs-linenum> 627: </span><span class='hs-comment'>------------------------------------------------------------------------</span>
<span class=hs-linenum> 628: </span><span class='hs-comment'>-- Appending and concatenation</span>
<span class=hs-linenum> 629: </span>
<span class=hs-linenum> 630: </span><span class='hs-definition'>append</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 631: </span><span class='hs-definition'>append</span> <span class='hs-varid'>src1</span> <span class='hs-varid'>src2</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum> 632: </span>  <span class='hs-keyword'>let</span> <span class='hs-varop'>!</span><span class='hs-varid'>len1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>src1</span>
<span class=hs-linenum> 633: </span>      <span class='hs-varop'>!</span><span class='hs-varid'>len2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>src2</span>
<span class=hs-linenum> 634: </span>   <span class='hs-keyword'>in</span> <span class='hs-varid'>create</span> <span class='hs-layout'>(</span><span class='hs-varid'>checkedAdd</span> <span class='hs-str'>"Short.append"</span> <span class='hs-varid'>len1</span> <span class='hs-varid'>len2</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dst</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 635: </span>        <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>src1</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>dst</span> <span class='hs-num'>0</span>    <span class='hs-varid'>len1</span>
<span class=hs-linenum> 636: </span>        <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>src2</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>dst</span> <span class='hs-varid'>len1</span> <span class='hs-varid'>len2</span>
<span class=hs-linenum> 637: </span>
<span class=hs-linenum> 638: </span><span class='hs-definition'>concat</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ShortByteString</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 639: </span><span class='hs-definition'>concat</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbss</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 640: </span>    <span class='hs-varid'>create</span> <span class='hs-layout'>(</span><span class='hs-varid'>totalLen</span> <span class='hs-num'>0</span> <span class='hs-varid'>sbss</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>dst</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copy</span> <span class='hs-varid'>dst</span> <span class='hs-num'>0</span> <span class='hs-varid'>sbss</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 641: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum> 642: </span>    <span class='hs-varid'>totalLen</span> <span class='hs-varop'>!</span><span class='hs-varid'>acc</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>acc</span>
<span class=hs-linenum> 643: </span>    <span class='hs-varid'>totalLen</span> <span class='hs-varop'>!</span><span class='hs-varid'>acc</span> <span class='hs-layout'>(</span><span class='hs-varid'>curr</span> <span class='hs-conop'>:</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 644: </span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>totalLen</span> <span class='hs-layout'>(</span><span class='hs-varid'>checkedAdd</span> <span class='hs-str'>"Short.concat"</span> <span class='hs-varid'>acc</span> <span class='hs-varop'>$</span> <span class='hs-varid'>length</span> <span class='hs-varid'>curr</span><span class='hs-layout'>)</span> <span class='hs-varid'>rest</span>
<span class=hs-linenum> 645: </span>
<span class=hs-linenum> 646: </span>    <span class='hs-varid'>copy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ShortByteString</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 647: </span>    <span class='hs-varid'>copy</span> <span class='hs-varop'>!</span><span class='hs-keyword'>_</span>   <span class='hs-varop'>!</span><span class='hs-keyword'>_</span>   <span class='hs-conid'>[]</span>                           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 648: </span>    <span class='hs-varid'>copy</span> <span class='hs-varop'>!</span><span class='hs-varid'>dst</span> <span class='hs-varop'>!</span><span class='hs-varid'>off</span> <span class='hs-layout'>(</span><span class='hs-varid'>src</span> <span class='hs-conop'>:</span> <span class='hs-varid'>sbss</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 649: </span>      <span class='hs-keyword'>let</span> <span class='hs-varop'>!</span><span class='hs-varid'>len</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>src</span>
<span class=hs-linenum> 650: </span>      <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>src</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>dst</span> <span class='hs-varid'>off</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 651: </span>      <span class='hs-varid'>copy</span> <span class='hs-varid'>dst</span> <span class='hs-layout'>(</span><span class='hs-varid'>off</span> <span class='hs-varop'>+</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbss</span>
<span class=hs-linenum> 652: </span>
<span class=hs-linenum> 653: </span><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<span class=hs-linenum> 654: </span><span class='hs-comment'>-- Basic interface</span>
<span class=hs-linenum> 655: </span>
<span class=hs-linenum> 656: </span><span class='hs-keyword'>infixr</span> <span class='hs-num'>5</span> <span class='hs-varop'>`cons`</span> <span class='hs-comment'>--same as list (:)</span>
<span class=hs-linenum> 657: </span><span class='hs-keyword'>infixl</span> <span class='hs-num'>5</span> <span class='hs-varop'>`snoc`</span>
<span class=hs-linenum> 658: </span>
<span class=hs-linenum> 659: </span><span class='hs-comment'>-- | /O(n)/ Append a byte to the end of a 'ShortByteString'</span>
<span class=hs-linenum> 660: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 661: </span><span class='hs-comment'>-- Note: copies the entire byte array</span>
<span class=hs-linenum> 662: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 663: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 664: </span><span class='hs-definition'>snoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 665: </span><span class='hs-definition'>snoc</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>len</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 666: </span>                     <span class='hs-varid'>newLen</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>checkedAdd</span> <span class='hs-str'>"Short.snoc"</span> <span class='hs-varid'>len</span> <span class='hs-num'>1</span>
<span class=hs-linenum> 667: </span>  <span class='hs-keyword'>in</span> <span class='hs-varid'>create</span> <span class='hs-varid'>newLen</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 668: </span>      <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 669: </span>      <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba</span> <span class='hs-varid'>len</span> <span class='hs-varid'>c</span>
<span class=hs-linenum> 670: </span>
<span class=hs-linenum> 671: </span><span class='hs-comment'>-- | /O(n)/ 'cons' is analogous to (:) for lists.</span>
<span class=hs-linenum> 672: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 673: </span><span class='hs-comment'>-- Note: copies the entire byte array</span>
<span class=hs-linenum> 674: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 675: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 676: </span><span class='hs-definition'>cons</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 677: </span><span class='hs-definition'>cons</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>len</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 678: </span>                     <span class='hs-varid'>newLen</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>checkedAdd</span> <span class='hs-str'>"Short.cons"</span> <span class='hs-varid'>len</span> <span class='hs-num'>1</span>
<span class=hs-linenum> 679: </span>  <span class='hs-keyword'>in</span> <span class='hs-varid'>create</span> <span class='hs-varid'>newLen</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 680: </span>      <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>c</span>
<span class=hs-linenum> 681: </span>      <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba</span> <span class='hs-num'>1</span> <span class='hs-varid'>len</span>
<span class=hs-linenum> 682: </span>
<span class=hs-linenum> 683: </span><span class='hs-comment'>-- | /O(1)/ Extract the last element of a ShortByteString, which must be finite and non-empty.</span>
<span class=hs-linenum> 684: </span><span class='hs-comment'>-- An exception will be thrown in the case of an empty ShortByteString.</span>
<span class=hs-linenum> 685: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 686: </span><span class='hs-comment'>-- This is a partial function, consider using 'unsnoc' instead.</span>
<span class=hs-linenum> 687: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 688: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 689: </span><span class='hs-definition'>last</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 690: </span><span class='hs-definition'>last</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sbs</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum> 691: </span>  <span class='hs-conid'>True</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>errorEmptySBS</span> <span class='hs-str'>"last"</span>
<span class=hs-linenum> 692: </span>  <span class='hs-conid'>False</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 693: </span>
<span class=hs-linenum> 694: </span><span class='hs-comment'>-- | /O(n)/ Extract the elements after the head of a ShortByteString, which must be non-empty.</span>
<span class=hs-linenum> 695: </span><span class='hs-comment'>-- An exception will be thrown in the case of an empty ShortByteString.</span>
<span class=hs-linenum> 696: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 697: </span><span class='hs-comment'>-- This is a partial function, consider using 'uncons' instead.</span>
<span class=hs-linenum> 698: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 699: </span><span class='hs-comment'>-- Note: copies the entire byte array</span>
<span class=hs-linenum> 700: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 701: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 702: </span><span class='hs-definition'>tail</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 703: </span><span class='hs-definition'>tail</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 704: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 705: </span>      <span class='hs-varid'>nl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span>
<span class=hs-linenum> 706: </span>  <span class='hs-keyword'>in</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sbs</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum> 707: </span>      <span class='hs-conid'>True</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>errorEmptySBS</span> <span class='hs-str'>"tail"</span>
<span class=hs-linenum> 708: </span>      <span class='hs-conid'>False</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>create</span> <span class='hs-varid'>nl</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>1</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>nl</span>
<span class=hs-linenum> 709: </span>
<span class=hs-linenum> 710: </span><span class='hs-comment'>-- | /O(n)/ Extract the 'head' and 'tail' of a ShortByteString, returning 'Nothing'</span>
<span class=hs-linenum> 711: </span><span class='hs-comment'>-- if it is empty.</span>
<span class=hs-linenum> 712: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 713: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 714: </span><span class='hs-definition'>uncons</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 715: </span><span class='hs-definition'>uncons</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 716: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 717: </span>      <span class='hs-varid'>nl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span>
<span class=hs-linenum> 718: </span>  <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<span class=hs-linenum> 719: </span>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>h</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span>
<span class=hs-linenum> 720: </span>                           <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>create</span> <span class='hs-varid'>nl</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>1</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>nl</span>
<span class=hs-linenum> 721: </span>                       <span class='hs-keyword'>in</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>h</span><span class='hs-layout'>,</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 722: </span>
<span class=hs-linenum> 723: </span><span class='hs-comment'>-- | /O(1)/ Extract the first element of a ShortByteString, which must be non-empty.</span>
<span class=hs-linenum> 724: </span><span class='hs-comment'>-- An exception will be thrown in the case of an empty ShortByteString.</span>
<span class=hs-linenum> 725: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 726: </span><span class='hs-comment'>-- This is a partial function, consider using 'uncons' instead.</span>
<span class=hs-linenum> 727: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 728: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 729: </span><span class='hs-definition'>head</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 730: </span><span class='hs-definition'>head</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sbs</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum> 731: </span>  <span class='hs-conid'>True</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>errorEmptySBS</span> <span class='hs-str'>"head"</span>
<span class=hs-linenum> 732: </span>  <span class='hs-conid'>False</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span>
<span class=hs-linenum> 733: </span>
<span class=hs-linenum> 734: </span><span class='hs-comment'>-- | /O(n)/ Return all the elements of a 'ShortByteString' except the last one.</span>
<span class=hs-linenum> 735: </span><span class='hs-comment'>-- An exception will be thrown in the case of an empty ShortByteString.</span>
<span class=hs-linenum> 736: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 737: </span><span class='hs-comment'>-- This is a partial function, consider using 'unsnoc' instead.</span>
<span class=hs-linenum> 738: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 739: </span><span class='hs-comment'>-- Note: copies the entire byte array</span>
<span class=hs-linenum> 740: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 741: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 742: </span><span class='hs-definition'>init</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 743: </span><span class='hs-definition'>init</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 744: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 745: </span>      <span class='hs-varid'>nl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span>
<span class=hs-linenum> 746: </span>  <span class='hs-keyword'>in</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sbs</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum> 747: </span>      <span class='hs-conid'>True</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>errorEmptySBS</span> <span class='hs-str'>"init"</span>
<span class=hs-linenum> 748: </span>      <span class='hs-conid'>False</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>create</span> <span class='hs-varid'>nl</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>nl</span>
<span class=hs-linenum> 749: </span>
<span class=hs-linenum> 750: </span><span class='hs-comment'>-- | /O(n)/ Extract the 'init' and 'last' of a ShortByteString, returning 'Nothing'</span>
<span class=hs-linenum> 751: </span><span class='hs-comment'>-- if it is empty.</span>
<span class=hs-linenum> 752: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 753: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 754: </span><span class='hs-definition'>unsnoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 755: </span><span class='hs-definition'>unsnoc</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 756: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 757: </span>      <span class='hs-varid'>nl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span>
<span class=hs-linenum> 758: </span>  <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<span class=hs-linenum> 759: </span>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>l'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 760: </span>                           <span class='hs-varid'>i</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>create</span> <span class='hs-varid'>nl</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>nl</span>
<span class=hs-linenum> 761: </span>                       <span class='hs-keyword'>in</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-varid'>l'</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 762: </span>
<span class=hs-linenum> 763: </span>
<span class=hs-linenum> 764: </span><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<span class=hs-linenum> 765: </span><span class='hs-comment'>-- Transformations</span>
<span class=hs-linenum> 766: </span>
<span class=hs-linenum> 767: </span><span class='hs-comment'>-- | /O(n)/ 'map' @f xs@ is the ShortByteString obtained by applying @f@ to each</span>
<span class=hs-linenum> 768: </span><span class='hs-comment'>-- element of @xs@.</span>
<span class=hs-linenum> 769: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 770: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 771: </span><span class='hs-definition'>map</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 772: </span><span class='hs-definition'>map</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 773: </span>    <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 774: </span>        <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 775: </span>    <span class='hs-keyword'>in</span> <span class='hs-varid'>create</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 776: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum> 777: </span>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 778: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>ba</span> <span class='hs-varop'>!</span><span class='hs-varid'>mba</span> <span class='hs-varop'>!</span><span class='hs-varid'>i</span> <span class='hs-varop'>!</span><span class='hs-varid'>l</span>
<span class=hs-linenum> 779: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 780: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 781: </span>          <span class='hs-keyword'>let</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 782: </span>          <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba</span> <span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 783: </span>          <span class='hs-varid'>go</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span>
<span class=hs-linenum> 784: </span>
<span class=hs-linenum> 785: </span>
<span class=hs-linenum> 786: </span><span class='hs-comment'>-- | /O(n)/ 'reverse' @xs@ efficiently returns the elements of @xs@ in reverse order.</span>
<span class=hs-linenum> 787: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 788: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 789: </span><span class='hs-definition'>reverse</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 790: </span><span class='hs-definition'>reverse</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 791: </span>    <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 792: </span>        <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 793: </span><span class='hs-cpp'>#if HS_UNALIGNED_ByteArray_OPS_OK</span>
<span class=hs-linenum> 794: </span>    <span class='hs-keyword'>in</span> <span class='hs-varid'>create</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>mba</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 795: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum> 796: </span>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>s</span><span class='hs-varop'>.</span> <span class='hs-conid'>ByteArray</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 797: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>ba</span> <span class='hs-varop'>!</span><span class='hs-varid'>mba</span> <span class='hs-varop'>!</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 798: </span>      <span class='hs-comment'>-- this is equivalent to: (q, r) = l `quotRem` 8</span>
<span class=hs-linenum> 799: </span>      <span class='hs-keyword'>let</span> <span class='hs-varid'>q</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span> <span class='hs-varop'>`shiftR`</span> <span class='hs-num'>3</span>
<span class=hs-linenum> 800: </span>          <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span> <span class='hs-varop'>.&amp;.</span> <span class='hs-num'>7</span>
<span class=hs-linenum> 801: </span>      <span class='hs-varid'>i'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>goWord8Chunk</span> <span class='hs-num'>0</span> <span class='hs-varid'>r</span>
<span class=hs-linenum> 802: </span>      <span class='hs-varid'>goWord64Chunk</span> <span class='hs-varid'>i'</span> <span class='hs-num'>0</span> <span class='hs-varid'>q</span>
<span class=hs-linenum> 803: </span>     <span class='hs-keyword'>where</span>
<span class=hs-linenum> 804: </span>
<span class=hs-linenum> 805: </span>      <span class='hs-varid'>goWord64Chunk</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 806: </span>      <span class='hs-varid'>goWord64Chunk</span> <span class='hs-varop'>!</span><span class='hs-varid'>off</span> <span class='hs-varop'>!</span><span class='hs-varid'>i'</span> <span class='hs-varop'>!</span><span class='hs-varid'>cl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loop</span> <span class='hs-varid'>i'</span>
<span class=hs-linenum> 807: </span>       <span class='hs-keyword'>where</span>
<span class=hs-linenum> 808: </span>        <span class='hs-varid'>loop</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 809: </span>        <span class='hs-varid'>loop</span> <span class='hs-varop'>!</span><span class='hs-varid'>i</span>
<span class=hs-linenum> 810: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>cl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 811: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 812: </span>              <span class='hs-keyword'>let</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8ArrayAsWord64</span> <span class='hs-varid'>ba</span> <span class='hs-layout'>(</span><span class='hs-varid'>off</span> <span class='hs-varop'>+</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>*</span> <span class='hs-num'>8</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 813: </span>              <span class='hs-varid'>writeWord64Array</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>cl</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span> <span class='hs-comment'>-</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>byteSwap64</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 814: </span>              <span class='hs-varid'>loop</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 815: </span>
<span class=hs-linenum> 816: </span>      <span class='hs-varid'>goWord8Chunk</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum> 817: </span>      <span class='hs-varid'>goWord8Chunk</span> <span class='hs-varop'>!</span><span class='hs-varid'>i'</span> <span class='hs-varop'>!</span><span class='hs-varid'>cl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loop</span> <span class='hs-varid'>i'</span>
<span class=hs-linenum> 818: </span>       <span class='hs-keyword'>where</span>
<span class=hs-linenum> 819: </span>        <span class='hs-varid'>loop</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum> 820: </span>        <span class='hs-varid'>loop</span> <span class='hs-varop'>!</span><span class='hs-varid'>i</span>
<span class=hs-linenum> 821: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>cl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 822: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 823: </span>              <span class='hs-keyword'>let</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 824: </span>              <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span> <span class='hs-comment'>-</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-varid'>w</span>
<span class=hs-linenum> 825: </span>              <span class='hs-varid'>loop</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 826: </span><span class='hs-cpp'>#else</span>
<span class=hs-linenum> 827: </span>    <span class='hs-keyword'>in</span> <span class='hs-varid'>create</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 828: </span>   <span class='hs-keyword'>where</span>
<span class=hs-linenum> 829: </span>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 830: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>ba</span> <span class='hs-varop'>!</span><span class='hs-varid'>mba</span> <span class='hs-varop'>!</span><span class='hs-varid'>i</span> <span class='hs-varop'>!</span><span class='hs-varid'>l</span>
<span class=hs-linenum> 831: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 832: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 833: </span>          <span class='hs-keyword'>let</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>i</span>
<span class=hs-linenum> 834: </span>          <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span> <span class='hs-comment'>-</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-varid'>w</span>
<span class=hs-linenum> 835: </span>          <span class='hs-varid'>go</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span>
<span class=hs-linenum> 836: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum> 837: </span>
<span class=hs-linenum> 838: </span>
<span class=hs-linenum> 839: </span><span class='hs-comment'>-- | /O(n)/ The 'intercalate' function takes a 'ShortByteString' and a list of</span>
<span class=hs-linenum> 840: </span><span class='hs-comment'>-- 'ShortByteString's and concatenates the list after interspersing the first</span>
<span class=hs-linenum> 841: </span><span class='hs-comment'>-- argument between each element of the list.</span>
<span class=hs-linenum> 842: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 843: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 844: </span><span class='hs-definition'>intercalate</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ShortByteString</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 845: </span><span class='hs-definition'>intercalate</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>case</span>
<span class=hs-linenum> 846: </span>                    <span class='hs-conid'>[]</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<span class=hs-linenum> 847: </span>                    <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-comment'>-- This branch exists for laziness, not speed</span>
<span class=hs-linenum> 848: </span>                    <span class='hs-layout'>(</span><span class='hs-varid'>sbs</span><span class='hs-conop'>:</span><span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varop'>!</span><span class='hs-varid'>totalLen</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>List.foldl'</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>acc</span> <span class='hs-varid'>chunk</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>acc</span> <span class='hs-varop'>+!</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sep</span> <span class='hs-varop'>+!</span> <span class='hs-varid'>length</span> <span class='hs-varid'>chunk</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span>
<span class=hs-linenum> 849: </span>                               <span class='hs-keyword'>in</span> <span class='hs-varid'>create</span> <span class='hs-varid'>totalLen</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 850: </span>                                      <span class='hs-keyword'>let</span> <span class='hs-varop'>!</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 851: </span>                                      <span class='hs-keyword'>in</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>l</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>mba</span> <span class='hs-varid'>l</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 852: </span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 853: </span>  <span class='hs-varid'>ba</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sep</span>
<span class=hs-linenum> 854: </span>  <span class='hs-varid'>lba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sep</span>
<span class=hs-linenum> 855: </span>
<span class=hs-linenum> 856: </span>  <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ShortByteString</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 857: </span>  <span class='hs-varid'>go</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>()</span>
<span class=hs-linenum> 858: </span>  <span class='hs-varid'>go</span> <span class='hs-varid'>mba</span> <span class='hs-varop'>!</span><span class='hs-varid'>off</span> <span class='hs-layout'>(</span><span class='hs-varid'>chunk</span><span class='hs-conop'>:</span><span class='hs-varid'>chunks</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum> 859: </span>    <span class='hs-keyword'>let</span> <span class='hs-varid'>lc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>chunk</span>
<span class=hs-linenum> 860: </span>    <span class='hs-varid'>copyByteArray</span> <span class='hs-varid'>ba</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba</span> <span class='hs-varid'>off</span> <span class='hs-varid'>lba</span>
<span class=hs-linenum> 861: </span>    <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>chunk</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>off</span> <span class='hs-varop'>+</span> <span class='hs-varid'>lba</span><span class='hs-layout'>)</span> <span class='hs-varid'>lc</span>
<span class=hs-linenum> 862: </span>    <span class='hs-varid'>go</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>off</span> <span class='hs-varop'>+</span> <span class='hs-varid'>lc</span> <span class='hs-varop'>+</span> <span class='hs-varid'>lba</span><span class='hs-layout'>)</span> <span class='hs-varid'>chunks</span>
<span class=hs-linenum> 863: </span>  <span class='hs-layout'>(</span><span class='hs-varop'>+!</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>checkedAdd</span> <span class='hs-str'>"Short.intercalate"</span>
<span class=hs-linenum> 864: </span>
<span class=hs-linenum> 865: </span>
<span class=hs-linenum> 866: </span><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<span class=hs-linenum> 867: </span><span class='hs-comment'>-- Reducing 'ShortByteString's</span>
<span class=hs-linenum> 868: </span>
<span class=hs-linenum> 869: </span><span class='hs-comment'>-- | 'foldl', applied to a binary operator, a starting value (typically</span>
<span class=hs-linenum> 870: </span><span class='hs-comment'>-- the left-identity of the operator), and a ShortByteString, reduces the</span>
<span class=hs-linenum> 871: </span><span class='hs-comment'>-- ShortByteString using the binary operator, from left to right.</span>
<span class=hs-linenum> 872: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 873: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 874: </span><span class='hs-definition'>foldl</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<span class=hs-linenum> 875: </span><span class='hs-definition'>foldl</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>List.foldl</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unpack</span>
<span class=hs-linenum> 876: </span>
<span class=hs-linenum> 877: </span><span class='hs-comment'>-- | 'foldl'' is like 'foldl', but strict in the accumulator.</span>
<span class=hs-linenum> 878: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 879: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 880: </span><span class='hs-definition'>foldl'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<span class=hs-linenum> 881: </span><span class='hs-definition'>foldl'</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>List.foldl'</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unpack</span>
<span class=hs-linenum> 882: </span>
<span class=hs-linenum> 883: </span><span class='hs-comment'>-- | 'foldr', applied to a binary operator, a starting value</span>
<span class=hs-linenum> 884: </span><span class='hs-comment'>-- (typically the right-identity of the operator), and a ShortByteString,</span>
<span class=hs-linenum> 885: </span><span class='hs-comment'>-- reduces the ShortByteString using the binary operator, from right to left.</span>
<span class=hs-linenum> 886: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 887: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 888: </span><span class='hs-definition'>foldr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<span class=hs-linenum> 889: </span><span class='hs-definition'>foldr</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 890: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 891: </span>      <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 892: </span>      <span class='hs-varid'>w</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span>
<span class=hs-linenum> 893: </span>      <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>l</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>v</span>
<span class=hs-linenum> 894: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 895: </span>  <span class='hs-keyword'>in</span> <span class='hs-varid'>go</span> <span class='hs-num'>0</span>
<span class=hs-linenum> 896: </span><span class='hs-comment'>{-# INLINE foldr #-}</span>
<span class=hs-linenum> 897: </span>
<span class=hs-linenum> 898: </span><span class='hs-comment'>-- | 'foldr'' is like 'foldr', but strict in the accumulator.</span>
<span class=hs-linenum> 899: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 900: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 901: </span><span class='hs-definition'>foldr'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<span class=hs-linenum> 902: </span><span class='hs-definition'>foldr'</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 903: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 904: </span>      <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 905: </span>      <span class='hs-varid'>w</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span>
<span class=hs-linenum> 906: </span>      <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>ix</span> <span class='hs-varop'>!</span><span class='hs-varid'>v'</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>ix</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>v'</span>
<span class=hs-linenum> 907: </span>                 <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>ix</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span> <span class='hs-varid'>ix</span><span class='hs-layout'>)</span> <span class='hs-varid'>v'</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 908: </span>  <span class='hs-keyword'>in</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>v</span>
<span class=hs-linenum> 909: </span><span class='hs-comment'>{-# INLINE foldr' #-}</span>
<span class=hs-linenum> 910: </span>
<span class=hs-linenum> 911: </span><span class='hs-comment'>-- | 'foldl1' is a variant of 'foldl' that has no starting value</span>
<span class=hs-linenum> 912: </span><span class='hs-comment'>-- argument, and thus must be applied to non-empty 'ShortByteString's.</span>
<span class=hs-linenum> 913: </span><span class='hs-comment'>-- An exception will be thrown in the case of an empty ShortByteString.</span>
<span class=hs-linenum> 914: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 915: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 916: </span><span class='hs-definition'>foldl1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 917: </span><span class='hs-definition'>foldl1</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>List.foldl1</span> <span class='hs-varid'>k</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unpack</span>
<span class=hs-linenum> 918: </span>
<span class=hs-linenum> 919: </span><span class='hs-comment'>-- | 'foldl1'' is like 'foldl1', but strict in the accumulator.</span>
<span class=hs-linenum> 920: </span><span class='hs-comment'>-- An exception will be thrown in the case of an empty ShortByteString.</span>
<span class=hs-linenum> 921: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 922: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 923: </span><span class='hs-definition'>foldl1'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 924: </span><span class='hs-definition'>foldl1'</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>List.foldl1'</span> <span class='hs-varid'>k</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unpack</span>
<span class=hs-linenum> 925: </span>
<span class=hs-linenum> 926: </span><span class='hs-comment'>-- | 'foldr1' is a variant of 'foldr' that has no starting value argument,</span>
<span class=hs-linenum> 927: </span><span class='hs-comment'>-- and thus must be applied to non-empty 'ShortByteString's</span>
<span class=hs-linenum> 928: </span><span class='hs-comment'>-- An exception will be thrown in the case of an empty ShortByteString.</span>
<span class=hs-linenum> 929: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 930: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 931: </span><span class='hs-definition'>foldr1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 932: </span><span class='hs-definition'>foldr1</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>List.foldr1</span> <span class='hs-varid'>k</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unpack</span>
<span class=hs-linenum> 933: </span>
<span class=hs-linenum> 934: </span><span class='hs-comment'>-- | 'foldr1'' is a variant of 'foldr1', but is strict in the</span>
<span class=hs-linenum> 935: </span><span class='hs-comment'>-- accumulator.</span>
<span class=hs-linenum> 936: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 937: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 938: </span><span class='hs-definition'>foldr1'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum> 939: </span><span class='hs-definition'>foldr1'</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sbs</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>errorEmptySBS</span> <span class='hs-str'>"foldr1'"</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>foldr'</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-varid'>last</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>init</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 940: </span>
<span class=hs-linenum> 941: </span>
<span class=hs-linenum> 942: </span>
<span class=hs-linenum> 943: </span><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<span class=hs-linenum> 944: </span><span class='hs-comment'>-- Special folds</span>
<span class=hs-linenum> 945: </span>
<span class=hs-linenum> 946: </span><span class='hs-comment'>-- | /O(n)/ Applied to a predicate and a 'ShortByteString', 'all' determines</span>
<span class=hs-linenum> 947: </span><span class='hs-comment'>-- if all elements of the 'ShortByteString' satisfy the predicate.</span>
<span class=hs-linenum> 948: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 949: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 950: </span><span class='hs-definition'>all</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum> 951: </span><span class='hs-definition'>all</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 952: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 953: </span>      <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 954: </span>      <span class='hs-varid'>w</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span>
<span class=hs-linenum> 955: </span>      <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>l</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<span class=hs-linenum> 956: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 957: </span>  <span class='hs-keyword'>in</span> <span class='hs-varid'>go</span> <span class='hs-num'>0</span>
<span class=hs-linenum> 958: </span>
<span class=hs-linenum> 959: </span>
<span class=hs-linenum> 960: </span><span class='hs-comment'>-- | /O(n)/ Applied to a predicate and a 'ShortByteString', 'any' determines if</span>
<span class=hs-linenum> 961: </span><span class='hs-comment'>-- any element of the 'ShortByteString' satisfies the predicate.</span>
<span class=hs-linenum> 962: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 963: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 964: </span><span class='hs-definition'>any</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum> 965: </span><span class='hs-definition'>any</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 966: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 967: </span>      <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 968: </span>      <span class='hs-varid'>w</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span>
<span class=hs-linenum> 969: </span>      <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>l</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<span class=hs-linenum> 970: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varop'>||</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 971: </span>  <span class='hs-keyword'>in</span> <span class='hs-varid'>go</span> <span class='hs-num'>0</span>
<span class=hs-linenum> 972: </span>
<span class=hs-linenum> 973: </span>
<span class=hs-linenum> 974: </span>
<span class=hs-linenum> 975: </span><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<span class=hs-linenum> 976: </span><span class='hs-comment'>-- Substrings</span>
<span class=hs-linenum> 977: </span>
<span class=hs-linenum> 978: </span><span class='hs-comment'>-- | /O(n)/ 'take' @n@, applied to a ShortByteString @xs@, returns the prefix</span>
<span class=hs-linenum> 979: </span><span class='hs-comment'>-- of @xs@ of length @n@, or @xs@ itself if @n &gt; 'length' xs@.</span>
<span class=hs-linenum> 980: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 981: </span><span class='hs-comment'>-- Note: copies the entire byte array</span>
<span class=hs-linenum> 982: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 983: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 984: </span><span class='hs-definition'>take</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 985: </span><span class='hs-definition'>take</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>sl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 986: </span>                     <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>sl</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 987: </span>                           <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<span class=hs-linenum> 988: </span>                           <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 989: </span>                               <span class='hs-varid'>create</span> <span class='hs-varid'>n</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>n</span>
<span class=hs-linenum> 990: </span>
<span class=hs-linenum> 991: </span><span class='hs-comment'>-- | Similar to 'Prelude.takeWhile',</span>
<span class=hs-linenum> 992: </span><span class='hs-comment'>-- returns the longest (possibly empty) prefix of elements</span>
<span class=hs-linenum> 993: </span><span class='hs-comment'>-- satisfying the predicate.</span>
<span class=hs-linenum> 994: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 995: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum> 996: </span><span class='hs-definition'>takeWhile</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum> 997: </span><span class='hs-definition'>takeWhile</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>take</span> <span class='hs-layout'>(</span><span class='hs-varid'>findIndexOrLength</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum> 998: </span>
<span class=hs-linenum> 999: </span><span class='hs-comment'>-- | /O(n)/ @'takeEnd' n xs@ is equivalent to @'drop' ('length' xs - n) xs@.</span>
<span class=hs-linenum>1000: </span><span class='hs-comment'>-- Takes @n@ elements from end of bytestring.</span>
<span class=hs-linenum>1001: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1002: </span><span class='hs-comment'>-- &gt;&gt;&gt; takeEnd 3 "abcdefg"</span>
<span class=hs-linenum>1003: </span><span class='hs-comment'>-- "efg"</span>
<span class=hs-linenum>1004: </span><span class='hs-comment'>-- &gt;&gt;&gt; takeEnd 0 "abcdefg"</span>
<span class=hs-linenum>1005: </span><span class='hs-comment'>-- ""</span>
<span class=hs-linenum>1006: </span><span class='hs-comment'>-- &gt;&gt;&gt; takeEnd 4 "abc"</span>
<span class=hs-linenum>1007: </span><span class='hs-comment'>-- "abc"</span>
<span class=hs-linenum>1008: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1009: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1010: </span><span class='hs-definition'>takeEnd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1011: </span><span class='hs-definition'>takeEnd</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>sl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1012: </span>                    <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>sl</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1013: </span>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<span class=hs-linenum>1014: </span>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>create</span> <span class='hs-varid'>n</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>max</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-varid'>sl</span> <span class='hs-comment'>-</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>1015: </span>
<span class=hs-linenum>1016: </span>
<span class=hs-linenum>1017: </span><span class='hs-comment'>-- | Returns the longest (possibly empty) suffix of elements</span>
<span class=hs-linenum>1018: </span><span class='hs-comment'>-- satisfying the predicate.</span>
<span class=hs-linenum>1019: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1020: </span><span class='hs-comment'>-- @'takeWhileEnd' p@ is equivalent to @'reverse' . 'takeWhile' p . 'reverse'@.</span>
<span class=hs-linenum>1021: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1022: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1023: </span><span class='hs-definition'>takeWhileEnd</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1024: </span><span class='hs-definition'>takeWhileEnd</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>drop</span> <span class='hs-layout'>(</span><span class='hs-varid'>findFromEndUntil</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1025: </span>
<span class=hs-linenum>1026: </span><span class='hs-comment'>-- | /O(n)/ 'drop' @n@ @xs@ returns the suffix of @xs@ after the first n elements, or 'empty' if @n &gt; 'length' xs@.</span>
<span class=hs-linenum>1027: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1028: </span><span class='hs-comment'>-- Note: copies the entire byte array</span>
<span class=hs-linenum>1029: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1030: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1031: </span><span class='hs-definition'>drop</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1032: </span><span class='hs-definition'>drop</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1033: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>len</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1034: </span>  <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1035: </span>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>len</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<span class=hs-linenum>1036: </span>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1037: </span>            <span class='hs-keyword'>let</span> <span class='hs-varid'>newLen</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>len</span> <span class='hs-comment'>-</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>1038: </span>            <span class='hs-keyword'>in</span> <span class='hs-varid'>create</span> <span class='hs-varid'>newLen</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>newLen</span>
<span class=hs-linenum>1039: </span>
<span class=hs-linenum>1040: </span><span class='hs-comment'>-- | /O(n)/ @'dropEnd' n xs@ is equivalent to @'take' ('length' xs - n) xs@.</span>
<span class=hs-linenum>1041: </span><span class='hs-comment'>-- Drops @n@ elements from end of bytestring.</span>
<span class=hs-linenum>1042: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1043: </span><span class='hs-comment'>-- &gt;&gt;&gt; dropEnd 3 "abcdefg"</span>
<span class=hs-linenum>1044: </span><span class='hs-comment'>-- "abcd"</span>
<span class=hs-linenum>1045: </span><span class='hs-comment'>-- &gt;&gt;&gt; dropEnd 0 "abcdefg"</span>
<span class=hs-linenum>1046: </span><span class='hs-comment'>-- "abcdefg"</span>
<span class=hs-linenum>1047: </span><span class='hs-comment'>-- &gt;&gt;&gt; dropEnd 4 "abc"</span>
<span class=hs-linenum>1048: </span><span class='hs-comment'>-- ""</span>
<span class=hs-linenum>1049: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1050: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1051: </span><span class='hs-definition'>dropEnd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1052: </span><span class='hs-definition'>dropEnd</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>sl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1053: </span>                        <span class='hs-varid'>nl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sl</span> <span class='hs-comment'>-</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>1054: </span>                    <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>sl</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<span class=hs-linenum>1055: </span>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1056: </span>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>create</span> <span class='hs-varid'>nl</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>nl</span>
<span class=hs-linenum>1057: </span>
<span class=hs-linenum>1058: </span><span class='hs-comment'>-- | Similar to 'Prelude.dropWhile',</span>
<span class=hs-linenum>1059: </span><span class='hs-comment'>-- drops the longest (possibly empty) prefix of elements</span>
<span class=hs-linenum>1060: </span><span class='hs-comment'>-- satisfying the predicate and returns the remainder.</span>
<span class=hs-linenum>1061: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1062: </span><span class='hs-comment'>-- Note: copies the entire byte array</span>
<span class=hs-linenum>1063: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1064: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1065: </span><span class='hs-definition'>dropWhile</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1066: </span><span class='hs-definition'>dropWhile</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>drop</span> <span class='hs-layout'>(</span><span class='hs-varid'>findIndexOrLength</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1067: </span>
<span class=hs-linenum>1068: </span><span class='hs-comment'>-- | Similar to 'Prelude.dropWhileEnd',</span>
<span class=hs-linenum>1069: </span><span class='hs-comment'>-- drops the longest (possibly empty) suffix of elements</span>
<span class=hs-linenum>1070: </span><span class='hs-comment'>-- satisfying the predicate and returns the remainder.</span>
<span class=hs-linenum>1071: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1072: </span><span class='hs-comment'>-- @'dropWhileEnd' p@ is equivalent to @'reverse' . 'dropWhile' p . 'reverse'@.</span>
<span class=hs-linenum>1073: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1074: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1075: </span><span class='hs-definition'>dropWhileEnd</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1076: </span><span class='hs-definition'>dropWhileEnd</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>take</span> <span class='hs-layout'>(</span><span class='hs-varid'>findFromEndUntil</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1077: </span>
<span class=hs-linenum>1078: </span><span class='hs-comment'>-- | Returns the longest (possibly empty) suffix of elements which __do not__</span>
<span class=hs-linenum>1079: </span><span class='hs-comment'>-- satisfy the predicate and the remainder of the string.</span>
<span class=hs-linenum>1080: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1081: </span><span class='hs-comment'>-- 'breakEnd' @p@ is equivalent to @'spanEnd' (not . p)@ and to @('takeWhileEnd' (not . p) &amp;&amp;&amp; 'dropWhileEnd' (not . p))@.</span>
<span class=hs-linenum>1082: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1083: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1084: </span><span class='hs-definition'>breakEnd</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1085: </span><span class='hs-definition'>breakEnd</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>splitAt</span> <span class='hs-layout'>(</span><span class='hs-varid'>findFromEndUntil</span> <span class='hs-varid'>p</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1086: </span>
<span class=hs-linenum>1087: </span><span class='hs-comment'>-- | Similar to 'Prelude.break',</span>
<span class=hs-linenum>1088: </span><span class='hs-comment'>-- returns the longest (possibly empty) prefix of elements which __do not__</span>
<span class=hs-linenum>1089: </span><span class='hs-comment'>-- satisfy the predicate and the remainder of the string.</span>
<span class=hs-linenum>1090: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1091: </span><span class='hs-comment'>-- 'break' @p@ is equivalent to @'span' (not . p)@ and to @('takeWhile' (not . p) &amp;&amp;&amp; 'dropWhile' (not . p))@.</span>
<span class=hs-linenum>1092: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1093: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1094: </span><span class='hs-definition'>break</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1095: </span><span class='hs-definition'>break</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>findIndexOrLength</span> <span class='hs-varid'>p</span> <span class='hs-varid'>sbs</span> <span class='hs-keyword'>of</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>take</span> <span class='hs-varid'>n</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>,</span> <span class='hs-varid'>drop</span> <span class='hs-varid'>n</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1096: </span><span class='hs-comment'>{-# INLINE break #-}</span>
<span class=hs-linenum>1097: </span>
<span class=hs-linenum>1098: </span><span class='hs-comment'>-- | Similar to 'Prelude.span',</span>
<span class=hs-linenum>1099: </span><span class='hs-comment'>-- returns the longest (possibly empty) prefix of elements</span>
<span class=hs-linenum>1100: </span><span class='hs-comment'>-- satisfying the predicate and the remainder of the string.</span>
<span class=hs-linenum>1101: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1102: </span><span class='hs-comment'>-- 'span' @p@ is equivalent to @'break' (not . p)@ and to @('takeWhile' p &amp;&amp;&amp; 'dropWhile' p)@.</span>
<span class=hs-linenum>1103: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1104: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1105: </span><span class='hs-definition'>span</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1106: </span><span class='hs-definition'>span</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>break</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1107: </span>
<span class=hs-linenum>1108: </span><span class='hs-comment'>-- | Returns the longest (possibly empty) suffix of elements</span>
<span class=hs-linenum>1109: </span><span class='hs-comment'>-- satisfying the predicate and the remainder of the string.</span>
<span class=hs-linenum>1110: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1111: </span><span class='hs-comment'>-- 'spanEnd' @p@ is equivalent to @'breakEnd' (not . p)@ and to @('takeWhileEnd' p &amp;&amp;&amp; 'dropWhileEnd' p)@.</span>
<span class=hs-linenum>1112: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1113: </span><span class='hs-comment'>-- We have</span>
<span class=hs-linenum>1114: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1115: </span><span class='hs-comment'>-- &gt; spanEnd (not . isSpace) "x y z" == ("x y ", "z")</span>
<span class=hs-linenum>1116: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1117: </span><span class='hs-comment'>-- and</span>
<span class=hs-linenum>1118: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1119: </span><span class='hs-comment'>-- &gt; spanEnd (not . isSpace) sbs</span>
<span class=hs-linenum>1120: </span><span class='hs-comment'>-- &gt;    ==</span>
<span class=hs-linenum>1121: </span><span class='hs-comment'>-- &gt; let (x, y) = span (not . isSpace) (reverse sbs) in (reverse y, reverse x)</span>
<span class=hs-linenum>1122: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1123: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1124: </span><span class='hs-definition'>spanEnd</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1125: </span><span class='hs-definition'>spanEnd</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>splitAt</span> <span class='hs-layout'>(</span><span class='hs-varid'>findFromEndUntil</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1126: </span>
<span class=hs-linenum>1127: </span><span class='hs-comment'>-- | /O(n)/ 'splitAt' @n sbs@ is equivalent to @('take' n sbs, 'drop' n sbs)@.</span>
<span class=hs-linenum>1128: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1129: </span><span class='hs-comment'>-- Note: copies the substrings</span>
<span class=hs-linenum>1130: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1131: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1132: </span><span class='hs-definition'>splitAt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1133: </span><span class='hs-definition'>splitAt</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span>
<span class=hs-linenum>1134: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>empty</span><span class='hs-layout'>,</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1135: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1136: </span>      <span class='hs-keyword'>let</span> <span class='hs-varid'>slen</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1137: </span>      <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>slen</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>sbs</span><span class='hs-layout'>,</span> <span class='hs-varid'>empty</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1138: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1139: </span>                <span class='hs-keyword'>let</span> <span class='hs-varid'>rlen</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>slen</span> <span class='hs-comment'>-</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>1140: </span>                    <span class='hs-varid'>lsbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>create</span> <span class='hs-varid'>n</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>1141: </span>                    <span class='hs-varid'>rsbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>create</span> <span class='hs-varid'>rlen</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>rlen</span>
<span class=hs-linenum>1142: </span>                <span class='hs-keyword'>in</span> <span class='hs-layout'>(</span><span class='hs-varid'>lsbs</span><span class='hs-layout'>,</span> <span class='hs-varid'>rsbs</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1143: </span>
<span class=hs-linenum>1144: </span><span class='hs-comment'>-- | /O(n)/ Break a 'ShortByteString' into pieces separated by the byte</span>
<span class=hs-linenum>1145: </span><span class='hs-comment'>-- argument, consuming the delimiter. I.e.</span>
<span class=hs-linenum>1146: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1147: </span><span class='hs-comment'>-- &gt; split 10  "a\nb\nd\ne" == ["a","b","d","e"]   -- fromEnum '\n' == 10</span>
<span class=hs-linenum>1148: </span><span class='hs-comment'>-- &gt; split 97  "aXaXaXa"    == ["","X","X","X",""] -- fromEnum 'a' == 97</span>
<span class=hs-linenum>1149: </span><span class='hs-comment'>-- &gt; split 120 "x"          == ["",""]             -- fromEnum 'x' == 120</span>
<span class=hs-linenum>1150: </span><span class='hs-comment'>-- &gt; split undefined ""     == []                  -- and not [""]</span>
<span class=hs-linenum>1151: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1152: </span><span class='hs-comment'>-- and</span>
<span class=hs-linenum>1153: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1154: </span><span class='hs-comment'>-- &gt; intercalate [c] . split c == id</span>
<span class=hs-linenum>1155: </span><span class='hs-comment'>-- &gt; split == splitWith . (==)</span>
<span class=hs-linenum>1156: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1157: </span><span class='hs-comment'>-- Note: copies the substrings</span>
<span class=hs-linenum>1158: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1159: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1160: </span><span class='hs-definition'>split</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ShortByteString</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>1161: </span><span class='hs-definition'>split</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>splitWith</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1162: </span>
<span class=hs-linenum>1163: </span>
<span class=hs-linenum>1164: </span><span class='hs-comment'>-- | /O(n)/ Splits a 'ShortByteString' into components delimited by</span>
<span class=hs-linenum>1165: </span><span class='hs-comment'>-- separators, where the predicate returns True for a separator element.</span>
<span class=hs-linenum>1166: </span><span class='hs-comment'>-- The resulting components do not contain the separators.  Two adjacent</span>
<span class=hs-linenum>1167: </span><span class='hs-comment'>-- separators result in an empty component in the output.  eg.</span>
<span class=hs-linenum>1168: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1169: </span><span class='hs-comment'>-- &gt; splitWith (==97) "aabbaca" == ["","","bb","c",""] -- fromEnum 'a' == 97</span>
<span class=hs-linenum>1170: </span><span class='hs-comment'>-- &gt; splitWith undefined ""     == []                  -- and not [""]</span>
<span class=hs-linenum>1171: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1172: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1173: </span><span class='hs-definition'>splitWith</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ShortByteString</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>1174: </span><span class='hs-definition'>splitWith</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span>
<span class=hs-linenum>1175: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sbs</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>[]</span>
<span class=hs-linenum>1176: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1177: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>1178: </span>    <span class='hs-varid'>go</span> <span class='hs-varid'>sbs'</span>
<span class=hs-linenum>1179: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sbs'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>empty</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>1180: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1181: </span>          <span class='hs-keyword'>case</span> <span class='hs-varid'>break</span> <span class='hs-varid'>p</span> <span class='hs-varid'>sbs'</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1182: </span>            <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1183: </span>              <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>b</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>1184: </span>              <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>tail</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1185: </span>
<span class=hs-linenum>1186: </span>
<span class=hs-linenum>1187: </span><span class='hs-comment'>-- | /O(n)/ The 'stripSuffix' function takes two ShortByteStrings and returns 'Just'</span>
<span class=hs-linenum>1188: </span><span class='hs-comment'>-- the remainder of the second iff the first is its suffix, and otherwise</span>
<span class=hs-linenum>1189: </span><span class='hs-comment'>-- 'Nothing'.</span>
<span class=hs-linenum>1190: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1191: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1192: </span><span class='hs-definition'>stripSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1193: </span><span class='hs-definition'>stripSuffix</span> <span class='hs-varid'>sbs1</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1194: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs1</span>
<span class=hs-linenum>1195: </span>      <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs2</span>
<span class=hs-linenum>1196: </span>  <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isSuffixOf</span> <span class='hs-varid'>sbs1</span> <span class='hs-varid'>sbs2</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1197: </span>         <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sbs1</span>
<span class=hs-linenum>1198: </span>         <span class='hs-keyword'>then</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>sbs2</span>
<span class=hs-linenum>1199: </span>         <span class='hs-keyword'>else</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$!</span> <span class='hs-varid'>create</span> <span class='hs-layout'>(</span><span class='hs-varid'>l2</span> <span class='hs-comment'>-</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dst</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1200: </span>                <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs2</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>dst</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-varid'>l2</span> <span class='hs-comment'>-</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1201: </span>     <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<span class=hs-linenum>1202: </span>
<span class=hs-linenum>1203: </span><span class='hs-comment'>-- | /O(n)/ The 'stripPrefix' function takes two ShortByteStrings and returns 'Just'</span>
<span class=hs-linenum>1204: </span><span class='hs-comment'>-- the remainder of the second iff the first is its prefix, and otherwise</span>
<span class=hs-linenum>1205: </span><span class='hs-comment'>-- 'Nothing'.</span>
<span class=hs-linenum>1206: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1207: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1208: </span><span class='hs-definition'>stripPrefix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1209: </span><span class='hs-definition'>stripPrefix</span> <span class='hs-varid'>sbs1</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1210: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs1</span>
<span class=hs-linenum>1211: </span>      <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs2</span>
<span class=hs-linenum>1212: </span>  <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isPrefixOf</span> <span class='hs-varid'>sbs1</span> <span class='hs-varid'>sbs2</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1213: </span>         <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sbs1</span>
<span class=hs-linenum>1214: </span>         <span class='hs-keyword'>then</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>sbs2</span>
<span class=hs-linenum>1215: </span>         <span class='hs-keyword'>else</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$!</span> <span class='hs-varid'>create</span> <span class='hs-layout'>(</span><span class='hs-varid'>l2</span> <span class='hs-comment'>-</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dst</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1216: </span>                <span class='hs-varid'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs2</span><span class='hs-layout'>)</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>dst</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-varid'>l2</span> <span class='hs-comment'>-</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1217: </span>     <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<span class=hs-linenum>1218: </span>
<span class=hs-linenum>1219: </span>
<span class=hs-linenum>1220: </span><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<span class=hs-linenum>1221: </span><span class='hs-comment'>-- Unfolds and replicates</span>
<span class=hs-linenum>1222: </span>
<span class=hs-linenum>1223: </span>
<span class=hs-linenum>1224: </span><span class='hs-comment'>-- | /O(n)/ 'replicate' @n x@ is a ShortByteString of length @n@ with @x@</span>
<span class=hs-linenum>1225: </span><span class='hs-comment'>-- the value of every element. The following holds:</span>
<span class=hs-linenum>1226: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1227: </span><span class='hs-comment'>-- &gt; replicate w c = unfoldr w (\u -&gt; Just (u,u)) c</span>
<span class=hs-linenum>1228: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1229: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1230: </span><span class='hs-definition'>replicate</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1231: </span><span class='hs-definition'>replicate</span> <span class='hs-varid'>w</span> <span class='hs-varid'>c</span>
<span class=hs-linenum>1232: </span>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>w</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<span class=hs-linenum>1233: </span>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>create</span> <span class='hs-varid'>w</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>setByteArray</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>w</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1234: </span>
<span class=hs-linenum>1235: </span>
<span class=hs-linenum>1236: </span><span class='hs-comment'>-- | /O(n)/, where /n/ is the length of the result.  The 'unfoldr'</span>
<span class=hs-linenum>1237: </span><span class='hs-comment'>-- function is analogous to the List \'unfoldr\'.  'unfoldr' builds a</span>
<span class=hs-linenum>1238: </span><span class='hs-comment'>-- ShortByteString from a seed value.  The function takes the element and</span>
<span class=hs-linenum>1239: </span><span class='hs-comment'>-- returns 'Nothing' if it is done producing the ShortByteString or returns</span>
<span class=hs-linenum>1240: </span><span class='hs-comment'>-- 'Just' @(a,b)@, in which case, @a@ is the next byte in the string,</span>
<span class=hs-linenum>1241: </span><span class='hs-comment'>-- and @b@ is the seed value for further production.</span>
<span class=hs-linenum>1242: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1243: </span><span class='hs-comment'>-- This function is not efficient/safe. It will build a list of @[Word8]@</span>
<span class=hs-linenum>1244: </span><span class='hs-comment'>-- and run the generator until it returns `Nothing`, otherwise recurse infinitely,</span>
<span class=hs-linenum>1245: </span><span class='hs-comment'>-- then finally create a 'ShortByteString'.</span>
<span class=hs-linenum>1246: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1247: </span><span class='hs-comment'>-- If you know the maximum length, consider using 'unfoldrN'.</span>
<span class=hs-linenum>1248: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1249: </span><span class='hs-comment'>-- Examples:</span>
<span class=hs-linenum>1250: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1251: </span><span class='hs-comment'>-- &gt;    unfoldr (\x -&gt; if x &lt;= 5 then Just (x, x + 1) else Nothing) 0</span>
<span class=hs-linenum>1252: </span><span class='hs-comment'>-- &gt; == pack [0, 1, 2, 3, 4, 5]</span>
<span class=hs-linenum>1253: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1254: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1255: </span><span class='hs-definition'>unfoldr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1256: </span><span class='hs-definition'>unfoldr</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x0</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>packBytesRev</span> <span class='hs-varop'>$</span> <span class='hs-varid'>go</span> <span class='hs-varid'>x0</span> <span class='hs-conid'>[]</span>
<span class=hs-linenum>1257: </span> <span class='hs-keyword'>where</span>
<span class=hs-linenum>1258: </span>   <span class='hs-varid'>go</span> <span class='hs-varid'>x</span> <span class='hs-varid'>words'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1259: </span>                    <span class='hs-conid'>Nothing</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>words'</span>
<span class=hs-linenum>1260: </span>                    <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span><span class='hs-layout'>,</span> <span class='hs-varid'>x'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>x'</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span><span class='hs-conop'>:</span><span class='hs-varid'>words'</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1261: </span>
<span class=hs-linenum>1262: </span><span class='hs-comment'>-- | /O(n)/ Like 'unfoldr', 'unfoldrN' builds a ShortByteString from a seed</span>
<span class=hs-linenum>1263: </span><span class='hs-comment'>-- value.  However, the length of the result is limited by the first</span>
<span class=hs-linenum>1264: </span><span class='hs-comment'>-- argument to 'unfoldrN'.  This function is more efficient than 'unfoldr'</span>
<span class=hs-linenum>1265: </span><span class='hs-comment'>-- when the maximum length of the result is known.</span>
<span class=hs-linenum>1266: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1267: </span><span class='hs-comment'>-- The following equation relates 'unfoldrN' and 'unfoldr':</span>
<span class=hs-linenum>1268: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1269: </span><span class='hs-comment'>-- &gt; fst (unfoldrN n f s) == take n (unfoldr f s)</span>
<span class=hs-linenum>1270: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1271: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1272: </span><span class='hs-definition'>unfoldrN</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1273: </span><span class='hs-definition'>unfoldrN</span> <span class='hs-varid'>i</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x0</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1274: </span>  <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>empty</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x0</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1275: </span>     <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>createAndTrim</span> <span class='hs-varid'>i</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>mba</span> <span class='hs-varid'>x0</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1276: </span>
<span class=hs-linenum>1277: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>1278: </span>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>s</span><span class='hs-varop'>.</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1279: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>mba</span> <span class='hs-varop'>!</span><span class='hs-varid'>x</span> <span class='hs-varop'>!</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>1280: </span>      <span class='hs-keyword'>where</span>
<span class=hs-linenum>1281: </span>        <span class='hs-varid'>go'</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1282: </span>        <span class='hs-varid'>go'</span> <span class='hs-varop'>!</span><span class='hs-varid'>x'</span> <span class='hs-varop'>!</span><span class='hs-varid'>n'</span>
<span class=hs-linenum>1283: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n'</span> <span class='hs-varop'>==</span> <span class='hs-varid'>i</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>n'</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x'</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1284: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x'</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1285: </span>                          <span class='hs-conid'>Nothing</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>n'</span><span class='hs-layout'>,</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1286: </span>                          <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span><span class='hs-layout'>,</span> <span class='hs-varid'>x''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1287: </span>                                             <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba</span> <span class='hs-varid'>n'</span> <span class='hs-varid'>w</span>
<span class=hs-linenum>1288: </span>                                             <span class='hs-varid'>go'</span> <span class='hs-varid'>x''</span> <span class='hs-layout'>(</span><span class='hs-varid'>n'</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1289: </span><span class='hs-comment'>{-# INLINE unfoldrN #-}</span>
<span class=hs-linenum>1290: </span>
<span class=hs-linenum>1291: </span>
<span class=hs-linenum>1292: </span>
<span class=hs-linenum>1293: </span><span class='hs-comment'>-- --------------------------------------------------------------------</span>
<span class=hs-linenum>1294: </span><span class='hs-comment'>-- Predicates</span>
<span class=hs-linenum>1295: </span>
<span class=hs-linenum>1296: </span><span class='hs-comment'>-- | Check whether one string is a substring of another.</span>
<span class=hs-linenum>1297: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1298: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1299: </span><span class='hs-definition'>isInfixOf</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum>1300: </span><span class='hs-definition'>isInfixOf</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sbs</span> <span class='hs-varop'>||</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>null</span> <span class='hs-varop'>$</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-conid'>GHC.Exts.inline</span> <span class='hs-varid'>breakSubstring</span><span class='hs-layout'>)</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1301: </span>
<span class=hs-linenum>1302: </span><span class='hs-comment'>-- |/O(n)/ The 'isPrefixOf' function takes two ShortByteStrings and returns 'True'</span>
<span class=hs-linenum>1303: </span><span class='hs-comment'>-- iff the first is a prefix of the second.</span>
<span class=hs-linenum>1304: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1305: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1306: </span><span class='hs-definition'>isPrefixOf</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum>1307: </span><span class='hs-definition'>isPrefixOf</span> <span class='hs-varid'>sbs1</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1308: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs1</span>
<span class=hs-linenum>1309: </span>      <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs2</span>
<span class=hs-linenum>1310: </span>  <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l1</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<span class=hs-linenum>1311: </span>     <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l2</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>l1</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<span class=hs-linenum>1312: </span>     <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1313: </span>         <span class='hs-keyword'>let</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>compareByteArraysOff</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs1</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs2</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varid'>l1</span>
<span class=hs-linenum>1314: </span>         <span class='hs-keyword'>in</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1315: </span>
<span class=hs-linenum>1316: </span><span class='hs-comment'>-- | /O(n)/ The 'isSuffixOf' function takes two ShortByteStrings and returns 'True'</span>
<span class=hs-linenum>1317: </span><span class='hs-comment'>-- iff the first is a suffix of the second.</span>
<span class=hs-linenum>1318: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1319: </span><span class='hs-comment'>-- The following holds:</span>
<span class=hs-linenum>1320: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1321: </span><span class='hs-comment'>-- &gt; isSuffixOf x y == reverse x `isPrefixOf` reverse y</span>
<span class=hs-linenum>1322: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1323: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1324: </span><span class='hs-definition'>isSuffixOf</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum>1325: </span><span class='hs-definition'>isSuffixOf</span> <span class='hs-varid'>sbs1</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1326: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs1</span>
<span class=hs-linenum>1327: </span>      <span class='hs-varid'>l2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs2</span>
<span class=hs-linenum>1328: </span>  <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l1</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<span class=hs-linenum>1329: </span>     <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l2</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>l1</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<span class=hs-linenum>1330: </span>     <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1331: </span>         <span class='hs-keyword'>let</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>compareByteArraysOff</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs1</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l2</span> <span class='hs-comment'>-</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-varid'>l1</span>
<span class=hs-linenum>1332: </span>         <span class='hs-keyword'>in</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1333: </span>
<span class=hs-linenum>1334: </span><span class='hs-comment'>-- | Break a string on a substring, returning a pair of the part of the</span>
<span class=hs-linenum>1335: </span><span class='hs-comment'>-- string prior to the match, and the rest of the string.</span>
<span class=hs-linenum>1336: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1337: </span><span class='hs-comment'>-- The following relationships hold:</span>
<span class=hs-linenum>1338: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1339: </span><span class='hs-comment'>-- &gt; break (== c) l == breakSubstring (singleton c) l</span>
<span class=hs-linenum>1340: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1341: </span><span class='hs-comment'>-- For example, to tokenise a string, dropping delimiters:</span>
<span class=hs-linenum>1342: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1343: </span><span class='hs-comment'>-- &gt; tokenise x y = h : if null t then [] else tokenise x (drop (length x) t)</span>
<span class=hs-linenum>1344: </span><span class='hs-comment'>-- &gt;     where (h,t) = breakSubstring x y</span>
<span class=hs-linenum>1345: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1346: </span><span class='hs-comment'>-- To skip to the first occurrence of a string:</span>
<span class=hs-linenum>1347: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1348: </span><span class='hs-comment'>-- &gt; snd (breakSubstring x y)</span>
<span class=hs-linenum>1349: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1350: </span><span class='hs-comment'>-- To take the parts of a string before a delimiter:</span>
<span class=hs-linenum>1351: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1352: </span><span class='hs-comment'>-- &gt; fst (breakSubstring x y)</span>
<span class=hs-linenum>1353: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1354: </span><span class='hs-comment'>-- Note that calling `breakSubstring x` does some preprocessing work, so</span>
<span class=hs-linenum>1355: </span><span class='hs-comment'>-- you should avoid unnecessarily duplicating breakSubstring calls with the same</span>
<span class=hs-linenum>1356: </span><span class='hs-comment'>-- pattern.</span>
<span class=hs-linenum>1357: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1358: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1359: </span><span class='hs-definition'>breakSubstring</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-comment'>-- ^ String to search for</span>
<span class=hs-linenum>1360: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-comment'>-- ^ String to search in</span>
<span class=hs-linenum>1361: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Head and tail of string broken at substring</span>
<span class=hs-linenum>1362: </span><span class='hs-definition'>breakSubstring</span> <span class='hs-varid'>pat</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1363: </span>  <span class='hs-keyword'>case</span> <span class='hs-varid'>lp</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1364: </span>    <span class='hs-num'>0</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>empty</span><span class='hs-layout'>,</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1365: </span>    <span class='hs-num'>1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>breakByte</span> <span class='hs-layout'>(</span><span class='hs-varid'>head</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1366: </span>    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>lp</span> <span class='hs-varop'>*</span> <span class='hs-num'>8</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>finiteBitSize</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1367: </span>             <span class='hs-keyword'>then</span> <span class='hs-varid'>shift</span>
<span class=hs-linenum>1368: </span>             <span class='hs-keyword'>else</span> <span class='hs-varid'>karpRabin</span>
<span class=hs-linenum>1369: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>1370: </span>    <span class='hs-varid'>lp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>pat</span>
<span class=hs-linenum>1371: </span>    <span class='hs-varid'>karpRabin</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1372: </span>    <span class='hs-varid'>karpRabin</span> <span class='hs-varid'>src</span>
<span class=hs-linenum>1373: </span>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>length</span> <span class='hs-varid'>src</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>lp</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>src</span><span class='hs-layout'>,</span><span class='hs-varid'>empty</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1374: </span>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>search</span> <span class='hs-layout'>(</span><span class='hs-varid'>rollingHash</span> <span class='hs-varop'>$</span> <span class='hs-varid'>take</span> <span class='hs-varid'>lp</span> <span class='hs-varid'>src</span><span class='hs-layout'>)</span> <span class='hs-varid'>lp</span>
<span class=hs-linenum>1375: </span>      <span class='hs-keyword'>where</span>
<span class=hs-linenum>1376: </span>        <span class='hs-varid'>k</span>           <span class='hs-keyglyph'>=</span> <span class='hs-num'>2891336453</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word32</span>
<span class=hs-linenum>1377: </span>        <span class='hs-varid'>rollingHash</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl'</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>h</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>h</span> <span class='hs-varop'>*</span> <span class='hs-varid'>k</span> <span class='hs-varop'>+</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1378: </span>        <span class='hs-varid'>hp</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rollingHash</span> <span class='hs-varid'>pat</span>
<span class=hs-linenum>1379: </span>        <span class='hs-varid'>m</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>k</span> <span class='hs-varop'>^</span> <span class='hs-varid'>lp</span>
<span class=hs-linenum>1380: </span>        <span class='hs-varid'>get</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unsafeIndex</span> <span class='hs-varid'>src</span>
<span class=hs-linenum>1381: </span>        <span class='hs-varid'>search</span> <span class='hs-varop'>!</span><span class='hs-varid'>hs</span> <span class='hs-varop'>!</span><span class='hs-varid'>i</span>
<span class=hs-linenum>1382: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>hp</span> <span class='hs-varop'>==</span> <span class='hs-varid'>hs</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>pat</span> <span class='hs-varop'>==</span> <span class='hs-varid'>take</span> <span class='hs-varid'>lp</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u</span>
<span class=hs-linenum>1383: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>length</span> <span class='hs-varid'>src</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>i</span>              <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>src</span><span class='hs-layout'>,</span> <span class='hs-varid'>empty</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- not found</span>
<span class=hs-linenum>1384: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>search</span> <span class='hs-varid'>hs'</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1385: </span>          <span class='hs-keyword'>where</span>
<span class=hs-linenum>1386: </span>            <span class='hs-varid'>u</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>splitAt</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-comment'>-</span> <span class='hs-varid'>lp</span><span class='hs-layout'>)</span> <span class='hs-varid'>src</span>
<span class=hs-linenum>1387: </span>            <span class='hs-varid'>hs'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs</span> <span class='hs-varop'>*</span> <span class='hs-varid'>k</span> <span class='hs-varop'>+</span>
<span class=hs-linenum>1388: </span>                  <span class='hs-varid'>get</span> <span class='hs-varid'>i</span> <span class='hs-comment'>-</span>
<span class=hs-linenum>1389: </span>                  <span class='hs-varid'>m</span> <span class='hs-varop'>*</span> <span class='hs-varid'>get</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-comment'>-</span> <span class='hs-varid'>lp</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1390: </span>    <span class='hs-comment'>{-# INLINE karpRabin #-}</span>
<span class=hs-linenum>1391: </span>
<span class=hs-linenum>1392: </span>    <span class='hs-varid'>shift</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1393: </span>    <span class='hs-varid'>shift</span> <span class='hs-varop'>!</span><span class='hs-varid'>src</span>
<span class=hs-linenum>1394: </span>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>length</span> <span class='hs-varid'>src</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>lp</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>src</span><span class='hs-layout'>,</span> <span class='hs-varid'>empty</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1395: </span>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>search</span> <span class='hs-layout'>(</span><span class='hs-varid'>intoWord</span> <span class='hs-varop'>$</span> <span class='hs-varid'>take</span> <span class='hs-varid'>lp</span> <span class='hs-varid'>src</span><span class='hs-layout'>)</span> <span class='hs-varid'>lp</span>
<span class=hs-linenum>1396: </span>      <span class='hs-keyword'>where</span>
<span class=hs-linenum>1397: </span>        <span class='hs-varid'>intoWord</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word</span>
<span class=hs-linenum>1398: </span>        <span class='hs-varid'>intoWord</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl'</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>w</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span> <span class='hs-varop'>`shiftL`</span> <span class='hs-num'>8</span><span class='hs-layout'>)</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1399: </span>
<span class=hs-linenum>1400: </span>        <span class='hs-varid'>wp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>intoWord</span> <span class='hs-varid'>pat</span>
<span class=hs-linenum>1401: </span>        <span class='hs-varid'>mask'</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span> <span class='hs-varop'>`shiftL`</span> <span class='hs-layout'>(</span><span class='hs-num'>8</span> <span class='hs-varop'>*</span> <span class='hs-varid'>lp</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span>
<span class=hs-linenum>1402: </span>        <span class='hs-varid'>search</span> <span class='hs-varop'>!</span><span class='hs-varid'>w</span> <span class='hs-varop'>!</span><span class='hs-varid'>i</span>
<span class=hs-linenum>1403: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>w</span> <span class='hs-varop'>==</span> <span class='hs-varid'>wp</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>splitAt</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-comment'>-</span> <span class='hs-varid'>lp</span><span class='hs-layout'>)</span> <span class='hs-varid'>src</span>
<span class=hs-linenum>1404: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>length</span> <span class='hs-varid'>src</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>src</span><span class='hs-layout'>,</span> <span class='hs-varid'>empty</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1405: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>search</span> <span class='hs-varid'>w'</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1406: </span>          <span class='hs-keyword'>where</span>
<span class=hs-linenum>1407: </span>            <span class='hs-varid'>b</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-layout'>(</span><span class='hs-varid'>unsafeIndex</span> <span class='hs-varid'>src</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1408: </span>            <span class='hs-varid'>w'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mask'</span> <span class='hs-varop'>.&amp;.</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>w</span> <span class='hs-varop'>`shiftL`</span> <span class='hs-num'>8</span><span class='hs-layout'>)</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1409: </span>    <span class='hs-comment'>{-# INLINE shift #-}</span>
<span class=hs-linenum>1410: </span>
<span class=hs-linenum>1411: </span>
<span class=hs-linenum>1412: </span><span class='hs-comment'>-- --------------------------------------------------------------------</span>
<span class=hs-linenum>1413: </span><span class='hs-comment'>-- Searching ShortByteString</span>
<span class=hs-linenum>1414: </span>
<span class=hs-linenum>1415: </span><span class='hs-comment'>-- | /O(n)/ 'elem' is the 'ShortByteString' membership predicate.</span>
<span class=hs-linenum>1416: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1417: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1418: </span><span class='hs-definition'>elem</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum>1419: </span><span class='hs-definition'>elem</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>elemIndex</span> <span class='hs-varid'>c</span> <span class='hs-varid'>sbs</span> <span class='hs-keyword'>of</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span> <span class='hs-layout'>;</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<span class=hs-linenum>1420: </span>
<span class=hs-linenum>1421: </span><span class='hs-comment'>-- | /O(n)/ 'filter', applied to a predicate and a ShortByteString,</span>
<span class=hs-linenum>1422: </span><span class='hs-comment'>-- returns a ShortByteString containing those characters that satisfy the</span>
<span class=hs-linenum>1423: </span><span class='hs-comment'>-- predicate.</span>
<span class=hs-linenum>1424: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1425: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1426: </span><span class='hs-definition'>filter</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1427: </span><span class='hs-definition'>filter</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1428: </span>                   <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1429: </span>                         <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>createAndTrim'</span> <span class='hs-varid'>l</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span>
<span class=hs-linenum>1430: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>1431: </span>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>s</span><span class='hs-varop'>.</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-comment'>-- mutable output bytestring</span>
<span class=hs-linenum>1432: </span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteArray</span>       <span class='hs-comment'>-- input bytestring</span>
<span class=hs-linenum>1433: </span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>             <span class='hs-comment'>-- length of input bytestring</span>
<span class=hs-linenum>1434: </span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>1435: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>mba</span> <span class='hs-varid'>ba</span> <span class='hs-varop'>!</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go'</span> <span class='hs-num'>0</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1436: </span>      <span class='hs-keyword'>where</span>
<span class=hs-linenum>1437: </span>        <span class='hs-varid'>go'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-comment'>-- bytes read</span>
<span class=hs-linenum>1438: </span>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-comment'>-- bytes written</span>
<span class=hs-linenum>1439: </span>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>1440: </span>        <span class='hs-varid'>go'</span> <span class='hs-varop'>!</span><span class='hs-varid'>br</span> <span class='hs-varop'>!</span><span class='hs-varid'>bw</span>
<span class=hs-linenum>1441: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>br</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>l</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varid'>bw</span>
<span class=hs-linenum>1442: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1443: </span>              <span class='hs-keyword'>let</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>br</span>
<span class=hs-linenum>1444: </span>              <span class='hs-keyword'>if</span> <span class='hs-varid'>k</span> <span class='hs-varid'>w</span>
<span class=hs-linenum>1445: </span>              <span class='hs-keyword'>then</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1446: </span>                <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba</span> <span class='hs-varid'>bw</span> <span class='hs-varid'>w</span>
<span class=hs-linenum>1447: </span>                <span class='hs-varid'>go'</span> <span class='hs-layout'>(</span><span class='hs-varid'>br</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>bw</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1448: </span>              <span class='hs-keyword'>else</span>
<span class=hs-linenum>1449: </span>                <span class='hs-varid'>go'</span> <span class='hs-layout'>(</span><span class='hs-varid'>br</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>bw</span>
<span class=hs-linenum>1450: </span><span class='hs-comment'>{-# INLINE filter #-}</span>
<span class=hs-linenum>1451: </span>
<span class=hs-linenum>1452: </span><span class='hs-comment'>-- | /O(n)/ The 'find' function takes a predicate and a ShortByteString,</span>
<span class=hs-linenum>1453: </span><span class='hs-comment'>-- and returns the first element in matching the predicate, or 'Nothing'</span>
<span class=hs-linenum>1454: </span><span class='hs-comment'>-- if there is no such element.</span>
<span class=hs-linenum>1455: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1456: </span><span class='hs-comment'>-- &gt; find f p = case findIndex f p of Just n -&gt; Just (p ! n) ; _ -&gt; Nothing</span>
<span class=hs-linenum>1457: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1458: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1459: </span><span class='hs-definition'>find</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum>1460: </span><span class='hs-definition'>find</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>findIndex</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sbs</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1461: </span>                    <span class='hs-conid'>Just</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>sbs</span> <span class='hs-varop'>`index`</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1462: </span>                    <span class='hs-keyword'>_</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<span class=hs-linenum>1463: </span><span class='hs-comment'>{-# INLINE find #-}</span>
<span class=hs-linenum>1464: </span>
<span class=hs-linenum>1465: </span><span class='hs-comment'>-- | /O(n)/ The 'partition' function takes a predicate a ShortByteString and returns</span>
<span class=hs-linenum>1466: </span><span class='hs-comment'>-- the pair of ShortByteStrings with elements which do and do not satisfy the</span>
<span class=hs-linenum>1467: </span><span class='hs-comment'>-- predicate, respectively; i.e.,</span>
<span class=hs-linenum>1468: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1469: </span><span class='hs-comment'>-- &gt; partition p bs == (filter p sbs, filter (not . p) sbs)</span>
<span class=hs-linenum>1470: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1471: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1472: </span><span class='hs-definition'>partition</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1473: </span><span class='hs-definition'>partition</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>len</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1474: </span>                   <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>sbs</span><span class='hs-layout'>,</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1475: </span>                         <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>createAndTrim2</span> <span class='hs-varid'>len</span> <span class='hs-varid'>len</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mba1</span> <span class='hs-varid'>mba2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>mba1</span> <span class='hs-varid'>mba2</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>len</span>
<span class=hs-linenum>1476: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>1477: </span>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>s</span><span class='hs-varop'>.</span>
<span class=hs-linenum>1478: </span>          <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-comment'>-- mutable output bytestring1</span>
<span class=hs-linenum>1479: </span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-comment'>-- mutable output bytestring2</span>
<span class=hs-linenum>1480: </span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteArray</span>       <span class='hs-comment'>-- input bytestring</span>
<span class=hs-linenum>1481: </span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>             <span class='hs-comment'>-- length of input bytestring</span>
<span class=hs-linenum>1482: </span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- (length mba1, length mba2)</span>
<span class=hs-linenum>1483: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>mba1</span> <span class='hs-varop'>!</span><span class='hs-varid'>mba2</span> <span class='hs-varid'>ba</span> <span class='hs-varop'>!</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go'</span> <span class='hs-num'>0</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1484: </span>      <span class='hs-keyword'>where</span>
<span class=hs-linenum>1485: </span>        <span class='hs-varid'>go'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-comment'>-- bytes read</span>
<span class=hs-linenum>1486: </span>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-comment'>-- bytes written to bytestring 1</span>
<span class=hs-linenum>1487: </span>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- (length mba1, length mba2)</span>
<span class=hs-linenum>1488: </span>        <span class='hs-varid'>go'</span> <span class='hs-varop'>!</span><span class='hs-varid'>br</span> <span class='hs-varop'>!</span><span class='hs-varid'>bw1</span>
<span class=hs-linenum>1489: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>br</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>l</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>bw1</span><span class='hs-layout'>,</span> <span class='hs-varid'>br</span> <span class='hs-comment'>-</span> <span class='hs-varid'>bw1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1490: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1491: </span>              <span class='hs-keyword'>let</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>br</span>
<span class=hs-linenum>1492: </span>              <span class='hs-keyword'>if</span> <span class='hs-varid'>k</span> <span class='hs-varid'>w</span>
<span class=hs-linenum>1493: </span>              <span class='hs-keyword'>then</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1494: </span>                <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba1</span> <span class='hs-varid'>bw1</span> <span class='hs-varid'>w</span>
<span class=hs-linenum>1495: </span>                <span class='hs-varid'>go'</span> <span class='hs-layout'>(</span><span class='hs-varid'>br</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>bw1</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1496: </span>              <span class='hs-keyword'>else</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1497: </span>                <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba2</span> <span class='hs-layout'>(</span><span class='hs-varid'>br</span> <span class='hs-comment'>-</span> <span class='hs-varid'>bw1</span><span class='hs-layout'>)</span> <span class='hs-varid'>w</span>
<span class=hs-linenum>1498: </span>                <span class='hs-varid'>go'</span> <span class='hs-layout'>(</span><span class='hs-varid'>br</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>bw1</span>
<span class=hs-linenum>1499: </span>
<span class=hs-linenum>1500: </span>
<span class=hs-linenum>1501: </span><span class='hs-comment'>-- --------------------------------------------------------------------</span>
<span class=hs-linenum>1502: </span><span class='hs-comment'>-- Indexing ShortByteString</span>
<span class=hs-linenum>1503: </span>
<span class=hs-linenum>1504: </span><span class='hs-comment'>-- | /O(n)/ The 'elemIndex' function returns the index of the first</span>
<span class=hs-linenum>1505: </span><span class='hs-comment'>-- element in the given 'ShortByteString' which is equal to the query</span>
<span class=hs-linenum>1506: </span><span class='hs-comment'>-- element, or 'Nothing' if there is no such element.</span>
<span class=hs-linenum>1507: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1508: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1509: </span><span class='hs-definition'>elemIndex</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>1510: </span><span class='hs-definition'>elemIndex</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>unSBS</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1511: </span>    <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1512: </span>    <span class='hs-varid'>accursedUnutterablePerformIO</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1513: </span>      <span class='hs-varop'>!</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>c_elem_index</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-varid'>c</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1514: </span>      <span class='hs-varid'>return</span> <span class='hs-varop'>$!</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>s</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1515: </span>
<span class=hs-linenum>1516: </span>
<span class=hs-linenum>1517: </span><span class='hs-comment'>-- | /O(n)/ The 'elemIndices' function extends 'elemIndex', by returning</span>
<span class=hs-linenum>1518: </span><span class='hs-comment'>-- the indices of all elements equal to the query element, in ascending order.</span>
<span class=hs-linenum>1519: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1520: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1521: </span><span class='hs-definition'>elemIndices</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Int</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>1522: </span><span class='hs-definition'>elemIndices</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>findIndices</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span><span class='hs-varid'>k</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1523: </span>
<span class=hs-linenum>1524: </span><span class='hs-comment'>-- | count returns the number of times its argument appears in the ShortByteString</span>
<span class=hs-linenum>1525: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1526: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1527: </span><span class='hs-definition'>count</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>1528: </span><span class='hs-definition'>count</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>unSBS</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>accursedUnutterablePerformIO</span> <span class='hs-varop'>$</span>
<span class=hs-linenum>1529: </span>    <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>BS.c_count_ba</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>$</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span> <span class='hs-varid'>w</span>
<span class=hs-linenum>1530: </span>
<span class=hs-linenum>1531: </span><span class='hs-comment'>-- | /O(n)/ The 'findIndex' function takes a predicate and a 'ShortByteString' and</span>
<span class=hs-linenum>1532: </span><span class='hs-comment'>-- returns the index of the first element in the ShortByteString</span>
<span class=hs-linenum>1533: </span><span class='hs-comment'>-- satisfying the predicate.</span>
<span class=hs-linenum>1534: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1535: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1536: </span><span class='hs-definition'>findIndex</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>1537: </span><span class='hs-definition'>findIndex</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1538: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1539: </span>      <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1540: </span>      <span class='hs-varid'>w</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span>
<span class=hs-linenum>1541: </span>      <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>l</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<span class=hs-linenum>1542: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>1543: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1544: </span>  <span class='hs-keyword'>in</span> <span class='hs-varid'>go</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1545: </span><span class='hs-comment'>{-# INLINE findIndex #-}</span>
<span class=hs-linenum>1546: </span>
<span class=hs-linenum>1547: </span>
<span class=hs-linenum>1548: </span><span class='hs-comment'>-- | /O(n)/ The 'findIndices' function extends 'findIndex', by returning the</span>
<span class=hs-linenum>1549: </span><span class='hs-comment'>-- indices of all elements satisfying the predicate, in ascending order.</span>
<span class=hs-linenum>1550: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1551: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1552: </span><span class='hs-definition'>findIndices</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Int</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>1553: </span><span class='hs-definition'>findIndices</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>1554: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1555: </span>      <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1556: </span>      <span class='hs-varid'>w</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span>
<span class=hs-linenum>1557: </span>      <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>l</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<span class=hs-linenum>1558: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-conop'>:</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1559: </span>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1560: </span>  <span class='hs-keyword'>in</span> <span class='hs-varid'>go</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1561: </span>
<span class=hs-linenum>1562: </span><span class='hs-comment'>------------------------------------------------------------------------</span>
<span class=hs-linenum>1563: </span><span class='hs-comment'>-- Exported low level operations</span>
<span class=hs-linenum>1564: </span>
<span class=hs-linenum>1565: </span><span class='hs-definition'>copyToPtr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span>  <span class='hs-comment'>-- ^ source data</span>
<span class=hs-linenum>1566: </span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>              <span class='hs-comment'>-- ^ offset into source</span>
<span class=hs-linenum>1567: </span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span>            <span class='hs-comment'>-- ^ destination</span>
<span class=hs-linenum>1568: </span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>              <span class='hs-comment'>-- ^ number of bytes to copy</span>
<span class=hs-linenum>1569: </span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>1570: </span><span class='hs-definition'>copyToPtr</span> <span class='hs-varid'>src</span> <span class='hs-varid'>off</span> <span class='hs-varid'>dst</span> <span class='hs-varid'>len</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1571: </span>    <span class='hs-varid'>stToIO</span> <span class='hs-varop'>$</span>
<span class=hs-linenum>1572: </span>      <span class='hs-varid'>copyByteArrayToAddr</span> <span class='hs-layout'>(</span><span class='hs-varid'>asBA</span> <span class='hs-varid'>src</span><span class='hs-layout'>)</span> <span class='hs-varid'>off</span> <span class='hs-varid'>dst</span> <span class='hs-varid'>len</span>
<span class=hs-linenum>1573: </span>
<span class=hs-linenum>1574: </span><span class='hs-definition'>createFromPtr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span>   <span class='hs-comment'>-- ^ source data</span>
<span class=hs-linenum>1575: </span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>     <span class='hs-comment'>-- ^ number of bytes to copy</span>
<span class=hs-linenum>1576: </span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1577: </span><span class='hs-definition'>createFromPtr</span> <span class='hs-varop'>!</span><span class='hs-varid'>ptr</span> <span class='hs-varid'>len</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1578: </span>    <span class='hs-varid'>stToIO</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1579: </span>      <span class='hs-varid'>mba</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newByteArray</span> <span class='hs-varid'>len</span>
<span class=hs-linenum>1580: </span>      <span class='hs-varid'>copyAddrToByteArray</span> <span class='hs-varid'>ptr</span> <span class='hs-varid'>mba</span> <span class='hs-num'>0</span> <span class='hs-varid'>len</span>
<span class=hs-linenum>1581: </span>      <span class='hs-conid'>ShortByteString</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>unsafeFreezeByteArray</span> <span class='hs-varid'>mba</span>
<span class=hs-linenum>1582: </span>
<span class=hs-linenum>1583: </span>
<span class=hs-linenum>1584: </span><span class='hs-comment'>------------------------------------------------------------------------</span>
<span class=hs-linenum>1585: </span><span class='hs-comment'>-- Primop wrappers</span>
<span class=hs-linenum>1586: </span>
<span class=hs-linenum>1587: </span><span class='hs-definition'>indexCharArray</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Char</span>
<span class=hs-linenum>1588: </span><span class='hs-definition'>indexCharArray</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>C</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>indexCharArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1589: </span>
<span class=hs-linenum>1590: </span><span class='hs-definition'>indexWord8Array</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum>1591: </span><span class='hs-definition'>indexWord8Array</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>W8</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>indexWord8Array</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1592: </span>
<span class=hs-linenum>1593: </span><span class='hs-cpp'>#if HS_UNALIGNED_ByteArray_OPS_OK</span>
<span class=hs-linenum>1594: </span><span class='hs-definition'>indexWord8ArrayAsWord64</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word64</span>
<span class=hs-linenum>1595: </span><span class='hs-definition'>indexWord8ArrayAsWord64</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>W64</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>indexWord8ArrayAsWord64</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1596: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum>1597: </span>
<span class=hs-linenum>1598: </span><span class='hs-definition'>newByteArray</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1599: </span><span class='hs-definition'>newByteArray</span> <span class='hs-varid'>len</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1600: </span>  <span class='hs-varid'>assert</span> <span class='hs-layout'>(</span><span class='hs-varid'>len</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<span class=hs-linenum>1601: </span>    <span class='hs-conid'>ST</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>newByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1602: </span>                 <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-varid'>mba</span><span class='hs-cpp'>#</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>mba</span><span class='hs-cpp'>#</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1603: </span>
<span class=hs-linenum>1604: </span><span class='hs-definition'>unsafeFreezeByteArray</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>ByteArray</span>
<span class=hs-linenum>1605: </span><span class='hs-definition'>unsafeFreezeByteArray</span> <span class='hs-layout'>(</span><span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>mba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1606: </span>    <span class='hs-conid'>ST</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unsafeFreezeByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>mba</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1607: </span>                 <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-conid'>ByteArray</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1608: </span>
<span class=hs-linenum>1609: </span><span class='hs-definition'>writeWord8Array</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>1610: </span><span class='hs-definition'>writeWord8Array</span> <span class='hs-layout'>(</span><span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>mba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>W8</span><span class='hs-cpp'>#</span> <span class='hs-varid'>w</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1611: </span>  <span class='hs-conid'>ST</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>writeWord8Array</span><span class='hs-cpp'>#</span> <span class='hs-varid'>mba</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-cpp'>#</span> <span class='hs-varid'>w</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1612: </span>               <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-conid'>()</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1613: </span>
<span class=hs-linenum>1614: </span><span class='hs-cpp'>#if HS_UNALIGNED_ByteArray_OPS_OK</span>
<span class=hs-linenum>1615: </span><span class='hs-definition'>writeWord64Array</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word64</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>1616: </span><span class='hs-definition'>writeWord64Array</span> <span class='hs-layout'>(</span><span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>mba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>W64</span><span class='hs-cpp'>#</span> <span class='hs-varid'>w</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1617: </span>  <span class='hs-conid'>ST</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>writeWord64Array</span><span class='hs-cpp'>#</span> <span class='hs-varid'>mba</span><span class='hs-cpp'>#</span> <span class='hs-varid'>i</span><span class='hs-cpp'>#</span> <span class='hs-varid'>w</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1618: </span>               <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-conid'>()</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1619: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum>1620: </span>
<span class=hs-linenum>1621: </span><span class='hs-definition'>copyAddrToByteArray</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-conid'>RealWorld</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-conid'>RealWorld</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>1622: </span><span class='hs-definition'>copyAddrToByteArray</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-varid'>src</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>dst</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst_off</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1623: </span>    <span class='hs-conid'>ST</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>copyAddrToByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>src</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst_off</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1624: </span>                 <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-conid'>()</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1625: </span>
<span class=hs-linenum>1626: </span><span class='hs-definition'>copyByteArrayToAddr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-conid'>RealWorld</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>1627: </span><span class='hs-definition'>copyByteArrayToAddr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>src</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>src_off</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-varid'>dst</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1628: </span>    <span class='hs-conid'>ST</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>copyByteArrayToAddr</span><span class='hs-cpp'>#</span> <span class='hs-varid'>src</span><span class='hs-cpp'>#</span> <span class='hs-varid'>src_off</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1629: </span>                 <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-conid'>()</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1630: </span>
<span class=hs-linenum>1631: </span><span class='hs-definition'>copyByteArray</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>1632: </span><span class='hs-definition'>copyByteArray</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>src</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>src_off</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>dst</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst_off</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1633: </span>    <span class='hs-conid'>ST</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>copyByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>src</span><span class='hs-cpp'>#</span> <span class='hs-varid'>src_off</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst_off</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1634: </span>                 <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-conid'>()</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1635: </span>
<span class=hs-linenum>1636: </span><span class='hs-definition'>setByteArray</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>1637: </span><span class='hs-definition'>setByteArray</span> <span class='hs-layout'>(</span><span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>dst</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>off</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>c</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1638: </span>    <span class='hs-conid'>ST</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>setByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst</span><span class='hs-cpp'>#</span> <span class='hs-varid'>off</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span> <span class='hs-varid'>c</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1639: </span>                 <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-conid'>()</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1640: </span>
<span class=hs-linenum>1641: </span><span class='hs-definition'>copyMutableByteArray</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>1642: </span><span class='hs-definition'>copyMutableByteArray</span> <span class='hs-layout'>(</span><span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>src</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>src_off</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>dst</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst_off</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1643: </span>    <span class='hs-conid'>ST</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>copyMutableByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>src</span><span class='hs-cpp'>#</span> <span class='hs-varid'>src_off</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst</span><span class='hs-cpp'>#</span> <span class='hs-varid'>dst_off</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1644: </span>                 <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-conid'>()</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1645: </span>
<span class=hs-linenum>1646: </span>
<span class=hs-linenum>1647: </span><span class='hs-comment'>------------------------------------------------------------------------</span>
<span class=hs-linenum>1648: </span><span class='hs-comment'>-- FFI imports</span>
<span class=hs-linenum>1649: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1650: </span><span class='hs-definition'>compareByteArrays</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteArray</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>1651: </span><span class='hs-definition'>compareByteArrays</span> <span class='hs-varid'>ba1</span> <span class='hs-varid'>ba2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>compareByteArraysOff</span> <span class='hs-varid'>ba1</span> <span class='hs-num'>0</span> <span class='hs-varid'>ba2</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1652: </span>
<span class=hs-linenum>1653: </span><span class='hs-definition'>compareByteArraysOff</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span>  <span class='hs-comment'>-- ^ array 1</span>
<span class=hs-linenum>1654: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-comment'>-- ^ offset for array 1</span>
<span class=hs-linenum>1655: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteArray</span>  <span class='hs-comment'>-- ^ array 2</span>
<span class=hs-linenum>1656: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-comment'>-- ^ offset for array 2</span>
<span class=hs-linenum>1657: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-comment'>-- ^ length to compare</span>
<span class=hs-linenum>1658: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-comment'>-- ^ like memcmp</span>
<span class=hs-linenum>1659: </span><span class='hs-cpp'>#if HS_compareByteArrays_PRIMOP_AVAILABLE</span>
<span class=hs-linenum>1660: </span><span class='hs-definition'>compareByteArraysOff</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>ba1</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba1off</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>ba2</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba2off</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1661: </span>  <span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>compareByteArrays</span><span class='hs-cpp'>#</span>  <span class='hs-varid'>ba1</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba1off</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba2</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba2off</span><span class='hs-cpp'>#</span> <span class='hs-varid'>len</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1662: </span><span class='hs-cpp'>#else</span>
<span class=hs-linenum>1663: </span><span class='hs-definition'>compareByteArraysOff</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>ba1</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-varid'>ba1off</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteArray</span> <span class='hs-varid'>ba2</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-varid'>ba2off</span> <span class='hs-varid'>len</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1664: </span>  <span class='hs-varid'>assert</span> <span class='hs-layout'>(</span><span class='hs-varid'>ba1off</span> <span class='hs-varop'>+</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&lt;=</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>sizeofByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba1</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1665: </span>  <span class='hs-varop'>$</span> <span class='hs-varid'>assert</span> <span class='hs-layout'>(</span><span class='hs-varid'>ba2off</span> <span class='hs-varop'>+</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&lt;=</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>sizeofByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba2</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1666: </span>  <span class='hs-varop'>$</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>$</span> <span class='hs-varid'>accursedUnutterablePerformIO</span> <span class='hs-varop'>$</span>
<span class=hs-linenum>1667: </span>    <span class='hs-varid'>c_memcmp_ByteArray</span> <span class='hs-varid'>ba1</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1668: </span>                       <span class='hs-varid'>ba1off</span>
<span class=hs-linenum>1669: </span>                       <span class='hs-varid'>ba2</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1670: </span>                       <span class='hs-varid'>ba2off</span>
<span class=hs-linenum>1671: </span>                       <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1672: </span>
<span class=hs-linenum>1673: </span>
<span class=hs-linenum>1674: </span><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"static sbs_memcmp_off"</span>
<span class=hs-linenum>1675: </span>  <span class='hs-varid'>c_memcmp_ByteArray</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteArray</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CSize</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span>
<span class=hs-linenum>1676: </span><span class='hs-cpp'>#endif</span>
<span class=hs-linenum>1677: </span>
<span class=hs-linenum>1678: </span><span class='hs-comment'>------------------------------------------------------------------------</span>
<span class=hs-linenum>1679: </span><span class='hs-comment'>-- Primop replacements</span>
<span class=hs-linenum>1680: </span>
<span class=hs-linenum>1681: </span><span class='hs-definition'>copyAddrToByteArray</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Addr</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1682: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span><span class='hs-cpp'>#</span> <span class='hs-conid'>RealWorld</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1683: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1684: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span><span class='hs-cpp'>#</span> <span class='hs-conid'>RealWorld</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span><span class='hs-cpp'>#</span> <span class='hs-conid'>RealWorld</span>
<span class=hs-linenum>1685: </span>
<span class=hs-linenum>1686: </span><span class='hs-definition'>copyByteArrayToAddr</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1687: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Addr</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1688: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1689: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span><span class='hs-cpp'>#</span> <span class='hs-conid'>RealWorld</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span><span class='hs-cpp'>#</span> <span class='hs-conid'>RealWorld</span>
<span class=hs-linenum>1690: </span>
<span class=hs-linenum>1691: </span><span class='hs-definition'>copyByteArray</span><span class='hs-cpp'>#</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteArray</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1692: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MutableByteArray</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1693: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1694: </span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span>
<span class=hs-linenum>1695: </span>
<span class=hs-linenum>1696: </span><span class='hs-definition'>copyAddrToByteArray</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GHC.Exts.copyAddrToByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1697: </span><span class='hs-definition'>copyByteArrayToAddr</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GHC.Exts.copyByteArrayToAddr</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1698: </span><span class='hs-definition'>copyByteArray</span><span class='hs-cpp'>#</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GHC.Exts.copyByteArray</span><span class='hs-cpp'>#</span>
<span class=hs-linenum>1699: </span>
<span class=hs-linenum>1700: </span><span class='hs-comment'>-- | /O(n)./ Construct a new @ShortByteString@ from a @CString@. The</span>
<span class=hs-linenum>1701: </span><span class='hs-comment'>-- resulting @ShortByteString@ is an immutable copy of the original</span>
<span class=hs-linenum>1702: </span><span class='hs-comment'>-- @CString@, and is managed on the Haskell heap. The original</span>
<span class=hs-linenum>1703: </span><span class='hs-comment'>-- @CString@ must be null terminated.</span>
<span class=hs-linenum>1704: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1705: </span><span class='hs-comment'>-- @since 0.10.10.0</span>
<span class=hs-linenum>1706: </span><span class='hs-definition'>packCString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1707: </span><span class='hs-definition'>packCString</span> <span class='hs-varid'>cstr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1708: </span>  <span class='hs-varid'>len</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>BS.c_strlen</span> <span class='hs-varid'>cstr</span>
<span class=hs-linenum>1709: </span>  <span class='hs-varid'>packCStringLen</span> <span class='hs-layout'>(</span><span class='hs-varid'>cstr</span><span class='hs-layout'>,</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1710: </span>
<span class=hs-linenum>1711: </span><span class='hs-comment'>-- | /O(n)./ Construct a new @ShortByteString@ from a @CStringLen@. The</span>
<span class=hs-linenum>1712: </span><span class='hs-comment'>-- resulting @ShortByteString@ is an immutable copy of the original @CStringLen@.</span>
<span class=hs-linenum>1713: </span><span class='hs-comment'>-- The @ShortByteString@ is a normal Haskell value and will be managed on the</span>
<span class=hs-linenum>1714: </span><span class='hs-comment'>-- Haskell heap.</span>
<span class=hs-linenum>1715: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1716: </span><span class='hs-comment'>-- @since 0.10.10.0</span>
<span class=hs-linenum>1717: </span><span class='hs-definition'>packCStringLen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CStringLen</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1718: </span><span class='hs-definition'>packCStringLen</span> <span class='hs-layout'>(</span><span class='hs-varid'>cstr</span><span class='hs-layout'>,</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>len</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>createFromPtr</span> <span class='hs-varid'>cstr</span> <span class='hs-varid'>len</span>
<span class=hs-linenum>1719: </span><span class='hs-definition'>packCStringLen</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1720: </span>  <span class='hs-varid'>moduleErrorIO</span> <span class='hs-str'>"packCStringLen"</span> <span class='hs-layout'>(</span><span class='hs-str'>"negative length: "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>len</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1721: </span>
<span class=hs-linenum>1722: </span><span class='hs-comment'>-- | /O(n) construction./ Use a @ShortByteString@ with a function requiring a</span>
<span class=hs-linenum>1723: </span><span class='hs-comment'>-- null-terminated @CString@.  The @CString@ is a copy and will be freed</span>
<span class=hs-linenum>1724: </span><span class='hs-comment'>-- automatically; it must not be stored or used after the</span>
<span class=hs-linenum>1725: </span><span class='hs-comment'>-- subcomputation finishes.</span>
<span class=hs-linenum>1726: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1727: </span><span class='hs-comment'>-- @since 0.10.10.0</span>
<span class=hs-linenum>1728: </span><span class='hs-definition'>useAsCString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>1729: </span><span class='hs-definition'>useAsCString</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>action</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1730: </span>  <span class='hs-varid'>allocaBytes</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>buf</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1731: </span>      <span class='hs-varid'>copyToPtr</span> <span class='hs-varid'>sbs</span> <span class='hs-num'>0</span> <span class='hs-varid'>buf</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1732: </span>      <span class='hs-varid'>pokeByteOff</span> <span class='hs-varid'>buf</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Word8</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1733: </span>      <span class='hs-varid'>action</span> <span class='hs-varid'>buf</span>
<span class=hs-linenum>1734: </span>  <span class='hs-keyword'>where</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1735: </span>
<span class=hs-linenum>1736: </span><span class='hs-comment'>-- | /O(n) construction./ Use a @ShortByteString@ with a function requiring a 'CStringLen'.</span>
<span class=hs-linenum>1737: </span><span class='hs-comment'>-- As for 'useAsCString' this function makes a copy of the original @ShortByteString@.</span>
<span class=hs-linenum>1738: </span><span class='hs-comment'>-- It must not be stored or used after the subcomputation finishes.</span>
<span class=hs-linenum>1739: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1740: </span><span class='hs-comment'>-- Beware that this function does not add a terminating @\NUL@ byte at the end of 'CStringLen'.</span>
<span class=hs-linenum>1741: </span><span class='hs-comment'>-- If you need to construct a pointer to a null-terminated sequence, use 'useAsCString'</span>
<span class=hs-linenum>1742: </span><span class='hs-comment'>-- (and measure length independently if desired).</span>
<span class=hs-linenum>1743: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1744: </span><span class='hs-comment'>-- @since 0.10.10.0</span>
<span class=hs-linenum>1745: </span><span class='hs-definition'>useAsCStringLen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CStringLen</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>1746: </span><span class='hs-definition'>useAsCStringLen</span> <span class='hs-varid'>sbs</span> <span class='hs-varid'>action</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1747: </span>  <span class='hs-varid'>allocaBytes</span> <span class='hs-varid'>l</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>buf</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1748: </span>      <span class='hs-varid'>copyToPtr</span> <span class='hs-varid'>sbs</span> <span class='hs-num'>0</span> <span class='hs-varid'>buf</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1749: </span>      <span class='hs-varid'>action</span> <span class='hs-layout'>(</span><span class='hs-varid'>buf</span><span class='hs-layout'>,</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1750: </span>  <span class='hs-keyword'>where</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1751: </span>
<span class=hs-linenum>1752: </span><span class='hs-comment'>-- | /O(n)/ Check whether a 'ShortByteString' represents valid UTF-8.</span>
<span class=hs-linenum>1753: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1754: </span><span class='hs-comment'>-- @since 0.11.3.0</span>
<span class=hs-linenum>1755: </span><span class='hs-definition'>isValidUtf8</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum>1756: </span><span class='hs-definition'>isValidUtf8</span> <span class='hs-varid'>sbs</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>unSBS</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>accursedUnutterablePerformIO</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1757: </span>  <span class='hs-keyword'>let</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1758: </span>  <span class='hs-comment'>-- Use a safe FFI call for large inputs to avoid GC synchronization pauses</span>
<span class=hs-linenum>1759: </span>  <span class='hs-comment'>-- in multithreaded contexts.</span>
<span class=hs-linenum>1760: </span>  <span class='hs-comment'>-- This specific limit was chosen based on results of a simple benchmark, see:</span>
<span class=hs-linenum>1761: </span>  <span class='hs-comment'>-- https://github.com/haskell/bytestring/issues/451#issuecomment-991879338</span>
<span class=hs-linenum>1762: </span>  <span class='hs-comment'>-- When changing this function, also consider changing the related function:</span>
<span class=hs-linenum>1763: </span>  <span class='hs-comment'>-- Data.ByteString.isValidUtf8</span>
<span class=hs-linenum>1764: </span>  <span class='hs-varid'>i</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>1000000</span> <span class='hs-varop'>||</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isPinned</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1765: </span>     <span class='hs-keyword'>then</span> <span class='hs-varid'>cIsValidUtf8BA</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1766: </span>     <span class='hs-keyword'>else</span> <span class='hs-varid'>cIsValidUtf8BASafe</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1767: </span>  <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-cpp'>#</span> <span class='hs-varid'>touch</span><span class='hs-cpp'>#</span> <span class='hs-varid'>ba</span><span class='hs-cpp'>#</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>()</span> <span class='hs-cpp'>#</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1768: </span>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>i</span> <span class='hs-varop'>/=</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1769: </span>
<span class=hs-linenum>1770: </span><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<span class=hs-linenum>1771: </span><span class='hs-comment'>-- Internal utilities</span>
<span class=hs-linenum>1772: </span>
<span class=hs-linenum>1773: </span><span class='hs-definition'>moduleErrorIO</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>1774: </span><span class='hs-definition'>moduleErrorIO</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>throwIO</span> <span class='hs-varop'>.</span> <span class='hs-varid'>userError</span> <span class='hs-varop'>$</span> <span class='hs-varid'>moduleErrorMsg</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>msg</span>
<span class=hs-linenum>1775: </span><span class='hs-comment'>{-# NOINLINE moduleErrorIO #-}</span>
<span class=hs-linenum>1776: </span>
<span class=hs-linenum>1777: </span><span class='hs-definition'>moduleErrorMsg</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<span class=hs-linenum>1778: </span><span class='hs-definition'>moduleErrorMsg</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Data.ByteString.Short."</span> <span class='hs-varop'>++</span> <span class='hs-varid'>fun</span> <span class='hs-varop'>++</span> <span class='hs-chr'>':'</span><span class='hs-conop'>:</span><span class='hs-chr'>' '</span><span class='hs-conop'>:</span><span class='hs-varid'>msg</span>
<span class=hs-linenum>1779: </span>
<span class=hs-linenum>1780: </span>
<span class=hs-linenum>1781: </span><span class='hs-comment'>-- Find from the end of the string using predicate.</span>
<span class=hs-linenum>1782: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>1783: </span><span class='hs-comment'>-- Return '0' if the predicate returns false for the entire ShortByteString.</span>
<span class=hs-linenum>1784: </span><span class='hs-definition'>findFromEndUntil</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>1785: </span><span class='hs-definition'>findFromEndUntil</span> <span class='hs-varid'>k</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1786: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>1787: </span>    <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1788: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1789: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span>
<span class=hs-linenum>1790: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1791: </span>
<span class=hs-linenum>1792: </span><span class='hs-definition'>findIndexOrLength</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>1793: </span><span class='hs-definition'>findIndexOrLength</span> <span class='hs-varid'>k</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-num'>0</span>
<span class=hs-linenum>1794: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>1795: </span>    <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1796: </span>    <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asBA</span> <span class='hs-varid'>sbs</span>
<span class=hs-linenum>1797: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>l</span>                   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<span class=hs-linenum>1798: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-varid'>indexWord8Array</span> <span class='hs-varid'>ba</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>1799: </span>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1800: </span>
<span class=hs-linenum>1801: </span>
<span class=hs-linenum>1802: </span><span class='hs-definition'>packBytesRev</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1803: </span><span class='hs-definition'>packBytesRev</span> <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>packLenBytesRev</span> <span class='hs-layout'>(</span><span class='hs-conid'>List.length</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span>
<span class=hs-linenum>1804: </span>
<span class=hs-linenum>1805: </span><span class='hs-definition'>packLenBytesRev</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span>
<span class=hs-linenum>1806: </span><span class='hs-definition'>packLenBytesRev</span> <span class='hs-varid'>len</span> <span class='hs-varid'>ws0</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>1807: </span>    <span class='hs-varid'>create</span> <span class='hs-varid'>len</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>mba</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-varid'>mba</span> <span class='hs-varid'>len</span> <span class='hs-varid'>ws0</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1808: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>1809: </span>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MutableByteArray</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>s</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>1810: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-keyword'>_</span>   <span class='hs-varop'>!</span><span class='hs-keyword'>_</span> <span class='hs-conid'>[]</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>1811: </span>    <span class='hs-varid'>go</span> <span class='hs-varop'>!</span><span class='hs-varid'>mba</span> <span class='hs-varop'>!</span><span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span><span class='hs-conop'>:</span><span class='hs-varid'>ws</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>1812: </span>      <span class='hs-varid'>writeWord8Array</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>w</span>
<span class=hs-linenum>1813: </span>      <span class='hs-varid'>go</span> <span class='hs-varid'>mba</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>ws</span>
<span class=hs-linenum>1814: </span>
<span class=hs-linenum>1815: </span>
<span class=hs-linenum>1816: </span><span class='hs-definition'>breakByte</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShortByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShortByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1817: </span><span class='hs-definition'>breakByte</span> <span class='hs-varid'>c</span> <span class='hs-varid'>sbs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>elemIndex</span> <span class='hs-varid'>c</span> <span class='hs-varid'>sbs</span> <span class='hs-keyword'>of</span>
<span class=hs-linenum>1818: </span>    <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>sbs</span><span class='hs-layout'>,</span> <span class='hs-varid'>empty</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1819: </span>    <span class='hs-conid'>Just</span> <span class='hs-varid'>n</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>take</span> <span class='hs-varid'>n</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>,</span> <span class='hs-varid'>drop</span> <span class='hs-varid'>n</span> <span class='hs-varid'>sbs</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1820: </span>
<span class=hs-linenum>1821: </span><span class='hs-comment'>-- Common up near identical calls to `error' to reduce the number</span>
<span class=hs-linenum>1822: </span><span class='hs-comment'>-- constant strings created when compiled:</span>
<span class=hs-linenum>1823: </span><span class='hs-definition'>errorEmptySBS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>1824: </span><span class='hs-definition'>errorEmptySBS</span> <span class='hs-varid'>fun</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>moduleError</span> <span class='hs-varid'>fun</span> <span class='hs-str'>"empty ShortByteString"</span>
<span class=hs-linenum>1825: </span><span class='hs-comment'>{-# NOINLINE errorEmptySBS #-}</span>
<span class=hs-linenum>1826: </span>
<span class=hs-linenum>1827: </span><span class='hs-definition'>moduleError</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HasCallStack</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>1828: </span><span class='hs-definition'>moduleError</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-layout'>(</span><span class='hs-varid'>moduleErrorMsg</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>msg</span><span class='hs-layout'>)</span>
<span class=hs-linenum>1829: </span><span class='hs-comment'>{-# NOINLINE moduleError #-}</span>
<span class=hs-linenum>1830: </span>
</pre>
</body>
</html>