<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>./Data/ByteString/Short.hs</title>
</head>
<head>
<link type='text/css' rel='stylesheet' href='liquid.css' />
</head>

<body>
<hr>
Put mouse over identifiers to see inferred types
<pre><span class=hs-linenum>  1: </span><a class=annot href="#"><span class=annottext>GHC.Types.Module</span><span class='hs-comment'>{-# LANGUAGE Trustworthy #-}</span></a>
<span class=hs-linenum>  2: </span>
<span class=hs-linenum>  3: </span><span class='hs-comment'>-- |</span>
<span class=hs-linenum>  4: </span><span class='hs-comment'>-- Module      : Data.ByteString.Short</span>
<span class=hs-linenum>  5: </span><span class='hs-comment'>-- Copyright   : (c) Duncan Coutts 2012-2013, Julian Ospald 2022</span>
<span class=hs-linenum>  6: </span><span class='hs-comment'>-- License     : BSD-style</span>
<span class=hs-linenum>  7: </span><span class='hs-comment'>--</span>
<span class=hs-linenum>  8: </span><span class='hs-comment'>-- Maintainer  : hasufell@posteo.de</span>
<span class=hs-linenum>  9: </span><span class='hs-comment'>-- Stability   : stable</span>
<span class=hs-linenum> 10: </span><span class='hs-comment'>-- Portability : ghc only</span>
<span class=hs-linenum> 11: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 12: </span><span class='hs-comment'>-- A compact representation suitable for storing short byte strings in memory.</span>
<span class=hs-linenum> 13: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 14: </span><span class='hs-comment'>-- In typical use cases it can be imported alongside "Data.ByteString", e.g.</span>
<span class=hs-linenum> 15: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 16: </span><span class='hs-comment'>-- &gt; import qualified Data.ByteString       as B</span>
<span class=hs-linenum> 17: </span><span class='hs-comment'>-- &gt; import qualified Data.ByteString.Short as B</span>
<span class=hs-linenum> 18: </span><span class='hs-comment'>-- &gt;          (ShortByteString, toShort, fromShort)</span>
<span class=hs-linenum> 19: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 20: </span><span class='hs-comment'>-- Other 'ShortByteString' operations clash with "Data.ByteString" or "Prelude"</span>
<span class=hs-linenum> 21: </span><span class='hs-comment'>-- functions however, so they should be imported @qualified@ with a different</span>
<span class=hs-linenum> 22: </span><span class='hs-comment'>-- alias e.g.</span>
<span class=hs-linenum> 23: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 24: </span><span class='hs-comment'>-- &gt; import qualified Data.ByteString.Short as B.Short</span>
<span class=hs-linenum> 25: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 26: </span><span class='hs-keyword'>module</span> <span class='hs-conid'>Data.ByteString.Short</span> <span class='hs-layout'>(</span>
<span class=hs-linenum> 27: </span>
<span class=hs-linenum> 28: </span>    <span class='hs-comment'>-- * The @ShortByteString@ type</span>
<span class=hs-linenum> 29: </span>
<span class=hs-linenum> 30: </span>    <span class='hs-conid'>ShortByteString</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 31: </span>
<span class=hs-linenum> 32: </span>    <span class='hs-comment'>-- ** Memory overhead</span>
<span class=hs-linenum> 33: </span>    <span class='hs-comment'>-- | With GHC, the memory overheads are as follows, expressed in words and</span>
<span class=hs-linenum> 34: </span>    <span class='hs-comment'>-- in bytes (words are 4 and 8 bytes on 32 or 64bit machines respectively).</span>
<span class=hs-linenum> 35: </span>    <span class='hs-comment'>--</span>
<span class=hs-linenum> 36: </span>    <span class='hs-comment'>-- * t'Data.ByteString.ByteString' unshared: 8 words; 32 or 64 bytes.</span>
<span class=hs-linenum> 37: </span>    <span class='hs-comment'>--</span>
<span class=hs-linenum> 38: </span>    <span class='hs-comment'>-- * t'Data.ByteString.ByteString' shared substring: 4 words; 16 or 32 bytes.</span>
<span class=hs-linenum> 39: </span>    <span class='hs-comment'>--</span>
<span class=hs-linenum> 40: </span>    <span class='hs-comment'>-- * 'ShortByteString': 4 words; 16 or 32 bytes.</span>
<span class=hs-linenum> 41: </span>    <span class='hs-comment'>--</span>
<span class=hs-linenum> 42: </span>    <span class='hs-comment'>-- For the string data itself, both 'ShortByteString' and t'Data.ByteString.ByteString' use</span>
<span class=hs-linenum> 43: </span>    <span class='hs-comment'>-- one byte per element, rounded up to the nearest word. For example,</span>
<span class=hs-linenum> 44: </span>    <span class='hs-comment'>-- including the overheads, a length 10 'ShortByteString' would take</span>
<span class=hs-linenum> 45: </span>    <span class='hs-comment'>-- @16 + 12 = 28@ bytes on a 32bit platform and @32 + 16 = 48@ bytes on a</span>
<span class=hs-linenum> 46: </span>    <span class='hs-comment'>-- 64bit platform.</span>
<span class=hs-linenum> 47: </span>    <span class='hs-comment'>--</span>
<span class=hs-linenum> 48: </span>    <span class='hs-comment'>-- These overheads can all be reduced by 1 word (4 or 8 bytes) when the</span>
<span class=hs-linenum> 49: </span>    <span class='hs-comment'>-- 'ShortByteString' or t'Data.ByteString.ByteString' is unpacked into another constructor.</span>
<span class=hs-linenum> 50: </span>    <span class='hs-comment'>--</span>
<span class=hs-linenum> 51: </span>    <span class='hs-comment'>-- For example:</span>
<span class=hs-linenum> 52: </span>    <span class='hs-comment'>--</span>
<span class=hs-linenum> 53: </span>    <span class='hs-comment'>-- &gt; data ThingId = ThingId {-# UNPACK #-} !Int</span>
<span class=hs-linenum> 54: </span>    <span class='hs-comment'>-- &gt;                        {-# UNPACK #-} !ShortByteString</span>
<span class=hs-linenum> 55: </span>    <span class='hs-comment'>--</span>
<span class=hs-linenum> 56: </span>    <span class='hs-comment'>-- This will take @1 + 1 + 3@ words (the @ThingId@ constructor +</span>
<span class=hs-linenum> 57: </span>    <span class='hs-comment'>-- unpacked @Int@ + unpacked @ShortByteString@), plus the words for the</span>
<span class=hs-linenum> 58: </span>    <span class='hs-comment'>-- string data.</span>
<span class=hs-linenum> 59: </span>
<span class=hs-linenum> 60: </span>    <span class='hs-comment'>-- ** Heap fragmentation</span>
<span class=hs-linenum> 61: </span>    <span class='hs-comment'>-- | With GHC, the t'Data.ByteString.ByteString' representation uses /pinned/ memory,</span>
<span class=hs-linenum> 62: </span>    <span class='hs-comment'>-- meaning it cannot be moved by the GC. This is usually the right thing to</span>
<span class=hs-linenum> 63: </span>    <span class='hs-comment'>-- do for larger strings, but for small strings using pinned memory can</span>
<span class=hs-linenum> 64: </span>    <span class='hs-comment'>-- lead to heap fragmentation which wastes space. The 'ShortByteString'</span>
<span class=hs-linenum> 65: </span>    <span class='hs-comment'>-- type (and the @Text@ type from the @text@ package) use /unpinned/ memory</span>
<span class=hs-linenum> 66: </span>    <span class='hs-comment'>-- so they do not contribute to heap fragmentation. In addition, with GHC,</span>
<span class=hs-linenum> 67: </span>    <span class='hs-comment'>-- small unpinned strings are allocated in the same way as normal heap</span>
<span class=hs-linenum> 68: </span>    <span class='hs-comment'>-- allocations, rather than in a separate pinned area.</span>
<span class=hs-linenum> 69: </span>
<span class=hs-linenum> 70: </span>    <span class='hs-comment'>-- * Introducing and eliminating 'ShortByteString's</span>
<span class=hs-linenum> 71: </span>    <span class='hs-varid'>empty</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 72: </span>    <span class='hs-varid'>singleton</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 73: </span>    <span class='hs-varid'>pack</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 74: </span>    <span class='hs-varid'>unpack</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 75: </span>    <span class='hs-varid'>fromShort</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 76: </span>    <span class='hs-varid'>toShort</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 77: </span>
<span class=hs-linenum> 78: </span>    <span class='hs-comment'>-- * Basic interface</span>
<span class=hs-linenum> 79: </span>    <span class='hs-varid'>snoc</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 80: </span>    <span class='hs-varid'>cons</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 81: </span>    <span class='hs-varid'>append</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 82: </span>    <span class='hs-varid'>last</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 83: </span>    <span class='hs-varid'>tail</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 84: </span>    <span class='hs-varid'>uncons</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 85: </span>    <span class='hs-varid'>head</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 86: </span>    <span class='hs-varid'>init</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 87: </span>    <span class='hs-varid'>unsnoc</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 88: </span>    <span class='hs-varid'>null</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 89: </span>    <span class='hs-varid'>length</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 90: </span>
<span class=hs-linenum> 91: </span>    <span class='hs-comment'>-- * Encoding validation</span>
<span class=hs-linenum> 92: </span>    <span class='hs-varid'>isValidUtf8</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 93: </span>
<span class=hs-linenum> 94: </span>    <span class='hs-comment'>-- * Transforming ShortByteStrings</span>
<span class=hs-linenum> 95: </span>    <span class='hs-varid'>map</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 96: </span>    <span class='hs-varid'>reverse</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 97: </span>    <span class='hs-varid'>intercalate</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 98: </span>
<span class=hs-linenum> 99: </span>    <span class='hs-comment'>-- * Reducing 'ShortByteString's (folds)</span>
<span class=hs-linenum>100: </span>    <span class='hs-varid'>foldl</span><span class='hs-layout'>,</span>
<span class=hs-linenum>101: </span>    <span class='hs-varid'>foldl'</span><span class='hs-layout'>,</span>
<span class=hs-linenum>102: </span>    <span class='hs-varid'>foldl1</span><span class='hs-layout'>,</span>
<span class=hs-linenum>103: </span>    <span class='hs-varid'>foldl1'</span><span class='hs-layout'>,</span>
<span class=hs-linenum>104: </span>
<span class=hs-linenum>105: </span>    <span class='hs-varid'>foldr</span><span class='hs-layout'>,</span>
<span class=hs-linenum>106: </span>    <span class='hs-varid'>foldr'</span><span class='hs-layout'>,</span>
<span class=hs-linenum>107: </span>    <span class='hs-varid'>foldr1</span><span class='hs-layout'>,</span>
<span class=hs-linenum>108: </span>    <span class='hs-varid'>foldr1'</span><span class='hs-layout'>,</span>
<span class=hs-linenum>109: </span>
<span class=hs-linenum>110: </span>    <span class='hs-comment'>-- ** Special folds</span>
<span class=hs-linenum>111: </span>    <span class='hs-varid'>all</span><span class='hs-layout'>,</span>
<span class=hs-linenum>112: </span>    <span class='hs-varid'>any</span><span class='hs-layout'>,</span>
<span class=hs-linenum>113: </span>    <span class='hs-varid'>concat</span><span class='hs-layout'>,</span>
<span class=hs-linenum>114: </span>
<span class=hs-linenum>115: </span>    <span class='hs-comment'>-- ** Generating and unfolding ByteStrings</span>
<span class=hs-linenum>116: </span>    <span class='hs-varid'>replicate</span><span class='hs-layout'>,</span>
<span class=hs-linenum>117: </span>    <span class='hs-varid'>unfoldr</span><span class='hs-layout'>,</span>
<span class=hs-linenum>118: </span>    <span class='hs-varid'>unfoldrN</span><span class='hs-layout'>,</span>
<span class=hs-linenum>119: </span>
<span class=hs-linenum>120: </span>    <span class='hs-comment'>-- * Substrings</span>
<span class=hs-linenum>121: </span>
<span class=hs-linenum>122: </span>    <span class='hs-comment'>-- ** Breaking strings</span>
<span class=hs-linenum>123: </span>    <span class='hs-varid'>take</span><span class='hs-layout'>,</span>
<span class=hs-linenum>124: </span>    <span class='hs-varid'>takeEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum>125: </span>    <span class='hs-varid'>takeWhileEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum>126: </span>    <span class='hs-varid'>takeWhile</span><span class='hs-layout'>,</span>
<span class=hs-linenum>127: </span>    <span class='hs-varid'>drop</span><span class='hs-layout'>,</span>
<span class=hs-linenum>128: </span>    <span class='hs-varid'>dropEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum>129: </span>    <span class='hs-varid'>dropWhile</span><span class='hs-layout'>,</span>
<span class=hs-linenum>130: </span>    <span class='hs-varid'>dropWhileEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum>131: </span>    <span class='hs-varid'>breakEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum>132: </span>    <span class='hs-varid'>break</span><span class='hs-layout'>,</span>
<span class=hs-linenum>133: </span>    <span class='hs-varid'>span</span><span class='hs-layout'>,</span>
<span class=hs-linenum>134: </span>    <span class='hs-varid'>spanEnd</span><span class='hs-layout'>,</span>
<span class=hs-linenum>135: </span>    <span class='hs-varid'>splitAt</span><span class='hs-layout'>,</span>
<span class=hs-linenum>136: </span>    <span class='hs-varid'>split</span><span class='hs-layout'>,</span>
<span class=hs-linenum>137: </span>    <span class='hs-varid'>splitWith</span><span class='hs-layout'>,</span>
<span class=hs-linenum>138: </span>    <span class='hs-varid'>stripSuffix</span><span class='hs-layout'>,</span>
<span class=hs-linenum>139: </span>    <span class='hs-varid'>stripPrefix</span><span class='hs-layout'>,</span>
<span class=hs-linenum>140: </span>
<span class=hs-linenum>141: </span>    <span class='hs-comment'>-- * Predicates</span>
<span class=hs-linenum>142: </span>    <span class='hs-varid'>isInfixOf</span><span class='hs-layout'>,</span>
<span class=hs-linenum>143: </span>    <span class='hs-varid'>isPrefixOf</span><span class='hs-layout'>,</span>
<span class=hs-linenum>144: </span>    <span class='hs-varid'>isSuffixOf</span><span class='hs-layout'>,</span>
<span class=hs-linenum>145: </span>
<span class=hs-linenum>146: </span>    <span class='hs-comment'>-- ** Search for arbitrary substrings</span>
<span class=hs-linenum>147: </span>    <span class='hs-varid'>breakSubstring</span><span class='hs-layout'>,</span>
<span class=hs-linenum>148: </span>
<span class=hs-linenum>149: </span>    <span class='hs-comment'>-- * Searching ShortByteStrings</span>
<span class=hs-linenum>150: </span>
<span class=hs-linenum>151: </span>    <span class='hs-comment'>-- ** Searching by equality</span>
<span class=hs-linenum>152: </span>    <span class='hs-varid'>elem</span><span class='hs-layout'>,</span>
<span class=hs-linenum>153: </span>
<span class=hs-linenum>154: </span>    <span class='hs-comment'>-- ** Searching with a predicate</span>
<span class=hs-linenum>155: </span>    <span class='hs-varid'>find</span><span class='hs-layout'>,</span>
<span class=hs-linenum>156: </span>    <span class='hs-varid'>filter</span><span class='hs-layout'>,</span>
<span class=hs-linenum>157: </span>    <span class='hs-varid'>partition</span><span class='hs-layout'>,</span>
<span class=hs-linenum>158: </span>
<span class=hs-linenum>159: </span>    <span class='hs-comment'>-- * Indexing ShortByteStrings</span>
<span class=hs-linenum>160: </span>    <span class='hs-varid'>index</span><span class='hs-layout'>,</span>
<span class=hs-linenum>161: </span>    <span class='hs-varid'>indexMaybe</span><span class='hs-layout'>,</span>
<span class=hs-linenum>162: </span>    <span class='hs-layout'>(</span><span class='hs-varop'>!?</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<span class=hs-linenum>163: </span>    <span class='hs-varid'>elemIndex</span><span class='hs-layout'>,</span>
<span class=hs-linenum>164: </span>    <span class='hs-varid'>elemIndices</span><span class='hs-layout'>,</span>
<span class=hs-linenum>165: </span>    <span class='hs-varid'>count</span><span class='hs-layout'>,</span>
<span class=hs-linenum>166: </span>    <span class='hs-varid'>findIndex</span><span class='hs-layout'>,</span>
<span class=hs-linenum>167: </span>    <span class='hs-varid'>findIndices</span><span class='hs-layout'>,</span>
<span class=hs-linenum>168: </span>
<span class=hs-linenum>169: </span>    <span class='hs-comment'>-- * Low level conversions</span>
<span class=hs-linenum>170: </span>    <span class='hs-comment'>-- ** Packing 'Foreign.C.String.CString's and pointers</span>
<span class=hs-linenum>171: </span>    <span class='hs-varid'>packCString</span><span class='hs-layout'>,</span>
<span class=hs-linenum>172: </span>    <span class='hs-varid'>packCStringLen</span><span class='hs-layout'>,</span>
<span class=hs-linenum>173: </span>
<span class=hs-linenum>174: </span>    <span class='hs-comment'>-- ** Using ShortByteStrings as 'Foreign.C.String.CString's</span>
<span class=hs-linenum>175: </span>    <span class='hs-varid'>useAsCString</span><span class='hs-layout'>,</span>
<span class=hs-linenum>176: </span>    <span class='hs-varid'>useAsCStringLen</span><span class='hs-layout'>,</span>
<span class=hs-linenum>177: </span>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum>178: </span>
<span class=hs-linenum>179: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.ByteString.Short.Internal</span>
<span class=hs-linenum>180: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>181: </span>
</pre>
</body>
</html>